<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Global Chosung Crossword</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --grid-bg: #333;
            --cell-bg: #fff;
            --cell-blocked: #ddd;
            --correct-color: #d4edda;
            --wrong-color: #f8d7da;
            --input-text: #333;
            --key-bg: #fff;
            --key-shadow: #bbb;
        }

        body {
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            padding-bottom: 220px;
            margin: 0;
            touch-action: manipulation;
            -webkit-text-size-adjust: 100%;
        }

        h1 { margin-bottom: 5px; color: #333; font-size: 1.5rem; }
        #date-display { margin-bottom: 10px; font-size: 1rem; color: #666; }
        
        #timer-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 20px;
            font-family: monospace;
            background: #e9ecef;
            padding: 5px 15px;
            border-radius: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-style {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background 0.2s;
            height: 36px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
        }
        .btn-style:hover { background-color: #0056b3; }
        .btn-style.active { background-color: #004494; box-shadow: inset 0 2px 5px rgba(0,0,0,0.3); }

        select.btn-style {
            appearance: none;
            padding-right: 30px;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right .7em top 50%;
            background-size: .65em auto;
        }
        select.btn-style option { background-color: white; color: #333; }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 1000px;
            width: 100%;
        }

        #status-msg {
            font-size: 1.2rem;
            color: #555;
            margin-top: 50px;
            text-align: center;
        }

        .crossword-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            aspect-ratio: 1 / 1;
            width: 100%;
            max-width: 380px;
            gap: 2px;
            background-color: var(--grid-bg);
            border: 4px solid var(--grid-bg);
            border-radius: 4px;
            box-sizing: border-box;
        }

        .cell {
            background-color: var(--cell-bg);
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .cell.blocked { background-color: var(--cell-blocked); }
        .cell:focus-within { box-shadow: inset 0 0 0 3px #4a90e2; z-index: 10; }

        .cell input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: clamp(14px, 5vw, 22px); 
            font-weight: bold;
            background: transparent;
            color: var(--input-text);
            padding: 0;
            outline: none;
            border-radius: 0;
            caret-color: transparent; 
        }
        .cell input::selection { background: rgba(0, 0, 0, 0.1); }
        .cell.correct { background-color: var(--correct-color) !important; }
        .cell.wrong { background-color: var(--wrong-color) !important; }

        .clue-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 10px;
            line-height: 1;
            color: #555;
            font-weight: bold;
            pointer-events: none;
            z-index: 5;
        }

        .revealed-text {
            font-size: clamp(10px, 4vw, 16px);
            font-weight: bold;
            color: #0056b3;
            text-align: center;
            line-height: 1.2;
            word-break: keep-all;
        }

        .clues-section {
            display: flex;
            gap: 20px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            box-sizing: border-box;
            font-size: 14px;
        }

        .clue-col { flex: 1; }
        .clue-col h3 { border-bottom: 2px solid #ddd; padding-bottom: 5px; margin-top: 0; }
        .clue-item { margin-bottom: 8px; line-height: 1.4; }
        .clue-item strong { color: #007bff; margin-right: 5px; }

        #virtual-keyboard {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #dcdcdc;
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none; 
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
            z-index: 1000;
            box-sizing: border-box;
        }
        #virtual-keyboard.visible { display: flex; }

        .key-btn {
            background-color: var(--key-bg);
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 0 var(--key-shadow);
            font-size: 18px;
            font-weight: bold;
            color: #333;
            width: 40px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }
        .key-btn:active { transform: translateY(2px); box-shadow: none; }

        #congrats-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 300px;
        }
        .modal-content h2 { color: #28a745; margin: 0 0 10px 0; font-size: 28px; }
        #ui-modal-time { color: #0056b3; font-weight: bold; margin-bottom: 20px; font-size: 1.2rem; }
        .close-btn {
            margin-top: 10px;
            padding: 10px 20px;
            background: #333;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }

        @media (max-width: 600px) {
            body { padding: 10px; padding-bottom: 220px; }
            .crossword-board {
                width: 95%; max-width: 380px; gap: 1px; border-width: 2px;
            }
            .clue-number { font-size: 8px; top: 1px; left: 1px; }
            .clues-section { flex-direction: column; gap: 20px; }
            .key-btn { width: 13%; height: 45px; margin-bottom: 5px; font-size: 16px; }
        }
    </style>
</head>
<body>

    <h1 id="ui-title">Ïò§ÎäòÏùò Ï¥àÏÑ± ÌÄ¥Ï¶à</h1>
    <div id="date-display">Loading...</div>
    
    <div id="timer-display">00:00</div>

    <div class="controls" id="game-controls" style="display:none;">
        <select id="language-select" class="btn-style" onchange="changeLanguage()">
            <option value="en" selected>üá∫üá∏ English</option>
            <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
            <option value="cn">üá®üá≥ ‰∏≠Êñá</option>
            <option value="jp">üáØüáµ Êó•Êú¨Ë™û</option>
            <option value="vn">üáªüá≥ Ti·∫øng Vi·ªát</option>
            <option value="id">üáÆüá© Indonesia</option>
            <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
            <option value="fr">üá´üá∑ Fran√ßais</option>
            <option value="es">üá™üá∏ Espa√±ol</option>
        </select>
        
        <button id="toggle-keyboard-btn" class="btn-style" onclick="toggleKeyboard()">‚å®Ô∏è ÏûêÌåê ÏºúÍ∏∞</button>
        <button id="reveal-btn" class="btn-style" onclick="revealAllAnswers()">üí° Ï†ïÎãµ Î≥¥Í∏∞</button>
        <button id="hint-btn" class="btn-style" onclick="useHint()">üîç ÌûåÌä∏ (+10Ï¥à)</button>
    </div>

    <div id="status-msg">Ïò§ÎäòÏùò ÌçºÏ¶êÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</div>

    <div class="game-container" id="game-board" style="display:none;">
        <div id="grid" class="crossword-board"></div>

        <div class="clues-section">
            <div class="clue-col">
                <h3 id="ui-header-h">Í∞ÄÎ°ú (Horizontal)</h3>
                <div id="hints-horizontal"></div>
            </div>
            <div class="clue-col">
                <h3 id="ui-header-v">ÏÑ∏Î°ú (Vertical)</h3>
                <div id="hints-vertical"></div>
            </div>
        </div>
    </div>

    <div id="virtual-keyboard"></div>

    <div id="congrats-modal">
        <div class="modal-content">
            <h2 id="ui-modal-title">ÏÑ±Í≥µ!</h2>
            <p id="ui-modal-desc">Ïò§ÎäòÏùò ÌçºÏ¶êÏùÑ ÏôÑÏÑ±ÌñàÏäµÎãàÎã§!</p>
            <p id="ui-modal-time"></p>
            <button id="ui-modal-close" class="close-btn" onclick="document.getElementById('congrats-modal').style.display='none'">Îã´Í∏∞</button>
        </div>
    </div>

    <script>
        let globalGridMap = [];
        let gridSize = 8;
        let lastFocusedInput = null; 
        let globalPuzzleData = []; 
        let currentLanguage = 'en'; 
        
        let timerSeconds = 0;
        let timerInterval = null;
        let isGameRunning = false;
        let isRevealed = false;
        let savedUserInputs = [];
        let wasTimerRunning = false;

        const CHOSUNG_LIST = ['„Ñ±','„Ñ≤','„Ñ¥','„Ñ∑','„Ñ∏','„Ñπ','„ÖÅ','„ÖÇ','„ÖÉ','„ÖÖ','„ÖÜ','„Öá','„Öà','„Öâ','„Öä','„Öã','„Öå','„Öç','„Öé'];

        const DEBUG_PUZZLE_DATA = [
            {
                "date": "2026-01-08",
                "gridSize": 8,
                "puzzleData": [
                    {
                        "id": 1,
                        "dir": "V",
                        "row": 2,
                        "col": 3,
                        "word_enc": "JUVCJUIzJUI0JUVCJUE2JUJGJUVBJUIzJUEwJUVBJUIwJTlD",
                        "hints": {
                            "en": "borigogae; boritgogae",
                            "ko": "(ÎπÑÏú†Ï†ÅÏúºÎ°ú) Í∑∏ Ï†Ñ Ìï¥Ïóê Í±∞ÎëêÏñ¥Îì§Ïù∏ Í≥°ÏãùÏùÄ Îã§ Îñ®Ïñ¥ÏßÄÍ≥† Î≥¥Î¶¨Îäî ÏïÑÏßÅ ÏùµÏßÄ ÏïäÏïÑ Î®πÏùÑ Í≤ÉÏù¥ Î™®ÏûêÎùºÏÑú Ïñ¥Î†§Ïö¥ Îïå.",
                            "cn": "Êò•ËçíÔºåÈ∫¶Âè£Êúü",
                            "jp": "„Éù„É™„ÉÉ„Ç≥„Ç≤„ÄÇ„Åó„ÇÖ„Çì„Åç„ÇÖ„ÅÜ„Åç„ÄêÊò•Á™ÆÊúü„Äë",
                            "vn": "boritgogae; k·ª≥ gi√°p h·∫°t",
                            "id": "boritgogae, masa kehabisan pangan",
                            "ru": "–±–æ—Ä–∏—Ç–∫–æ–≥—ç",
                            "fr": "boritgogae, p√©riode de disette, p√©riode difficile (pr√©c√©dant la r√©colte de l'orge)",
                            "es": "boritgogae"
                        }
                    },
                    {
                        "id": 2,
                        "dir": "H",
                        "row": 5,
                        "col": 3,
                        "word_enc": "JUVBJUIxJUIwJUVDJThBJUE0JUVCJUE2JTg0JUVCJThGJTg4",
                        "hints": {
                            "en": "change",
                            "ko": "ÏπòÎü¨Ïïº Ìï† ÎèàÏùÑ ÎπºÍ≥† ÎèÑÎ°ú Ï£ºÍ±∞ÎÇò Î∞õÎäî Îèà.",
                            "cn": "ÊâæÂ§¥ÔºåÈõ∂Èí±",
                            "jp": "„Åä„Å§„Çä„Äê„ÅäÈá£„Çä„Äë„ÄÇ„Å§„Çä„Åõ„Çì„ÄêÈá£„ÇäÈä≠„Äë„ÄÇ„Åä„Åã„Åà„Åó„Äê„ÅäËøî„Åó„Äë",
                            "vn": "ti·ªÅn th·ªëi l·∫°i, ti·ªÅn tr·∫£ l·∫°i",
                            "id": "uang kembalian",
                            "ru": "—Å–¥–∞—á–∞",
                            "fr": "monnaie",
                            "es": "cambio "
                        }
                    },
                    {
                        "id": 3,
                        "dir": "H",
                        "row": 2,
                        "col": 3,
                        "word_enc": "JUVCJUIwJTk0JUVCJUIzJUI0JUVDJTgzJTgxJUVDJTlFJTkw",
                        "hints": {
                            "en": "television",
                            "ko": "(Í∞ïÏ°∞ÌïòÎäî ÎßêÎ°ú) Î∂ÄÏ†ïÏ†ÅÏù∏ ÏùòÎØ∏Ïùò ÌÖîÎ†àÎπÑÏ†Ñ.",
                            "cn": "ÁôΩÁó¥ÁÆ±",
                            "jp": "(ÂØæË®≥Ë™ûÁÑ°„Åó)",
                            "vn": "m√†n h√¨nh v√¥ tri v√¥ gi√°c ",
                            "id": "pembodohan",
                            "ru": "–≥–ª—É–ø—ã–π —è—â–∏–∫ (–æ —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–µ)",
                            "fr": "bo√Æte √† stupidit√©s",
                            "es": "caja tonta"
                        }
                    },
                    {
                        "id": 4,
                        "dir": "H",
                        "row": 4,
                        "col": 0,
                        "word_enc": "JUVBJUIxJUIwJUVDJUEwJTgxJUVCJTk1JThDJUVBJUI4JUIw",
                        "hints": {
                            "en": "geojeokttaegi; old straw mat",
                            "ko": "(ÏÜçÎêú ÎßêÎ°ú) Ìóå Í±∞Ï†Å.",
                            "cn": "Á†¥Ëã´Â≠ê",
                            "jp": "„Åµ„Çã„ÅÑ„ÇÄ„Åó„Çç„ÄêÂè§„ÅÑÁ≠µ„ÉªÂè§„ÅÑËéö„ÉªÂè§„ÅÑËìÜ„ÉªÂè§„ÅÑÂ∏≠„Äë",
                            "vn": "Geojeokttaegi; manh chi·∫øu",
                            "id": "geojeokttaegi",
                            "ru": "–∫–æ–¥–∂–æ–∫—Ç—Ç—ç–≥–∏ ",
                            "fr": "geojeokttaegi, bout de natte",
                            "es": "geojeokttaegi, estera de paja vieja"
                        }
                    },
                    {
                        "id": 5,
                        "dir": "V",
                        "row": 1,
                        "col": 1,
                        "word_enc": "JUVBJUI1JUFDJUVDJThCJTlDJUVCJThDJTgwJUVDJUEwJTgx",
                        "hints": {
                            "en": "being outdated; being outmoded",
                            "ko": "ÏòàÏ†Ñ ÏãúÎåÄÏóêÎßå ÏûàÍ±∞ÎÇò ÏÉàÎ°úÏö¥ ÏãúÎåÄÏóê ÎßûÏßÄ ÏïäÍ≤å Ïò§ÎûòÎêú Í≤É.",
                            "cn": "ÊóßÊó∂‰ª£ÁöÑÔºåËÄÅÂ•óÁöÑ",
                            "jp": "„Åò„Å†„ÅÑ„Åä„Åè„Çå„ÄêÊôÇ‰ª£ÈÅÖ„Çå„Äë„ÄÇ„Åò„Åõ„ÅÑ„Åä„Åè„Çå„ÄêÊôÇÂã¢ÈÅÖ„Çå„Äë",
                            "vn": "t√≠nh c·ªï h≈©, t√≠nh l·∫°c h·∫≠u, t√≠nh l·ªói th·ªùi ",
                            "id": "kuno, lawas, ketinggalan zaman",
                            "ru": "—É—Å—Ç–∞—Ä–µ–≤—à–∏–π; –¥—Ä–µ–≤–Ω–∏–π",
                            "fr": "(n.) d√©mod√©, pass√©, vieilli, obsol√®te",
                            "es": "lo obsoleto, lo anticuado "
                        }
                    },
                    {
                        "id": 6,
                        "dir": "V",
                        "row": 5,
                        "col": 6,
                        "word_enc": "JUVCJThGJThDJUVDJUE5JThDJUVBJUI3JTgw",
                        "hints": {
                            "en": "hinge",
                            "ko": "Î¨∏ÏßùÏùÑ Îã¨Í∏∞ ÏúÑÌï¥ ÌïúÏ™ΩÏùÄ Î¨∏ÌãÄÏóê Îã§Î•∏ ÌïúÏ™ΩÏùÄ Î¨∏ÏßùÏóê Í≥†Ï†ïÏãúÌÇ§Îäî Ïá†Î∂ôÏù¥.",
                            "cn": "ÂêàÈ°µ",
                            "jp": "„Å°„Çá„ÅÜ„Å§„Åå„ÅÑ„ÄêËù∂Áï™„Äë",
                            "vn": "b·∫£n l·ªÅ",
                            "id": "engsel",
                            "ru": "–¥–≤–µ—Ä–Ω–∞—è –ø–µ—Ç–ª—è; —à–∞—Ä–Ω–∏—Ä",
                            "fr": "charni√®re m√©tallique",
                            "es": "bisagra, gozne, charnela, charneta"
                        }
                    },
                    {
                        "id": 7,
                        "dir": "H",
                        "row": 7,
                        "col": 4,
                        "word_enc": "JUVDJTg0JUIxJUVDJTlEJUI4JUVBJUI1JUIwJUVDJTlFJTkw",
                        "hints": {
                            "en": "noble man",
                            "ko": "ÏÑ±ÌíàÏù¥ Îõ∞Ïñ¥ÎÇòÍ≥† ÎçïÍ≥º ÌïôÏãùÏù¥ ÎÜíÏïÑ ÎßéÏùÄ ÏÇ¨ÎûåÎì§Ïù¥ Î≥∏Î∞õÏùÑ ÎßåÌïú ÏÇ¨Îûå.",
                            "cn": "Âú£‰∫∫ÂêõÂ≠ê",
                            "jp": "„Åõ„ÅÑ„Åò„Çì„Åè„Çì„Åó„ÄêËÅñ‰∫∫ÂêõÂ≠ê„Äë„ÄÇ„Åõ„ÅÑ„Åò„Çì„ÄêËÅñ‰∫∫„Äë",
                            "vn": "th√°nh nh√¢n qu√¢n t·ª≠ ",
                            "id": "orang suci, orang bijak",
                            "ru": "–ø—Ä–∏–º–µ—Ä –¥–ª—è –ø–æ–¥—Ä–∞–∂–∞–Ω–∏—è",
                            "fr": "saints et sages, saint ",
                            "es": "persona noble"
                        }
                    },
                    {
                        "id": 8,
                        "dir": "V",
                        "row": 4,
                        "col": 0,
                        "word_enc": "JUVBJUIwJTkzJUVCJTgyJTlDJUVDJTk1JTg0JUVBJUI4JUIw",
                        "hints": {
                            "en": "newborn baby",
                            "ko": "ÌÉúÏñ¥ÎÇú ÏßÄ ÏñºÎßà Ïïà Îêú ÏïÑÍ∏∞.",
                            "cn": "Êñ∞ÁîüÂÑø",
                            "jp": "„ÅÇ„Åã„Çì„Åº„ÅÜ„ÄêËµ§„ÇìÂùä„Äë„ÄÇ„ÅÇ„Åã„Åî„ÄêËµ§Â≠ê„Äë„ÄÇ„Åó„Çì„Åõ„ÅÑ„Åò„ÄêÊñ∞ÁîüÂÖê„Äë",
                            "vn": "ƒë·ª©a tr·∫ª s∆° sinh ",
                            "id": "jabang bayi, orok, bayi yang masih merah",
                            "ru": "–º–ª–∞–¥–µ–Ω–µ—Ü; –Ω–æ–≤–æ—Ä–æ–∂–¥–µ–Ω–Ω—ã–π",
                            "fr": "nouveau-n√©",
                            "es": "reci√©n nacido "
                        }
                    },
                    {
                        "id": 9,
                        "dir": "V",
                        "row": 1,
                        "col": 6,
                        "word_enc": "JUVCJTgyJTlDJUVDJTlFJUE1JUVEJThDJTkw",
                        "hints": {
                            "en": "chaos; disorder; mess",
                            "ko": "Ïó¨Îü¨ ÏÇ¨ÎûåÏù¥ Îí§ÏÑûÏó¨ ÏãúÎÅÑÎüΩÍ≤å ÌïòÍ±∞ÎÇò Ïñ¥ÏßàÎü¨ ÎÜìÏùÄ ÏÉÅÌÉú. ÎòêÎäî Í∑∏Îü∞ Í≥≥.",
                            "cn": "‰π±Â•óÔºå‰π±Âú∫",
                            "jp": "„Åä„Åä„Åï„Çè„Åé„ÄêÂ§ßÈ®í„Åé„Äë„ÄÇ„Å†„ÅÑ„Åù„ÅÜ„Å©„ÅÜ„ÄêÂ§ßÈ®íÂãï„Äë„ÄÇ„Åù„ÅÜ„Çâ„Çì„ÄêÈ®í‰π±„Äë",
                            "vn": "t√¨nh tr·∫°ng h·ªón ƒë·ªôn",
                            "id": "(adegan) kekacauan, (tempat) kekacauan",
                            "ru": "–±–∞–∑–∞—Ä; —Å—Ç–æ–ª–ø–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ; –±–µ—Å–ø–æ—Ä—è–¥–æ–∫; –±–∞—Ä–¥–∞–∫",
                            "fr": "pagaille, bazar, foutoir, vacarme, tapage, chahut",
                            "es": "alboroto, desorden, turbamulta"
                        }
                    },
                    {
                        "id": 10,
                        "dir": "H",
                        "row": 7,
                        "col": 0,
                        "word_enc": "JUVBJUIwJTgwJUVEJThDJTkwJUVCJThDJTgw",
                        "hints": {
                            "en": "stall",
                            "ko": "Î¨ºÍ±¥ÏùÑ ÎÜìÍ≥† ÌåîÍ∏∞ ÏúÑÌï¥ Í±∞Î¶¨Ïóê ÏûÑÏãúÎ°ú ÏÑ§ÏπòÌïú Í∏∞Íµ¨.",
                            "cn": "Êëä‰ΩçÔºåË∑ØËæπÊëä",
                            "jp": "„Åå„ÅÑ„ÅØ„Çì„Å†„ÅÑ„ÄêË°óË≤©Âè∞„Äë„ÄÇ„ÅÜ„Çä„Å†„ÅÑ„ÄêÂ£≤„ÇäÂè∞„Äë",
                            "vn": "s·∫°p h√†ng t·∫°m",
                            "id": "kios ",
                            "ru": "–∫–∏–æ—Å–∫; –ª–∞–≤–∫–∞; —Ç–æ—Ä–≥–æ–≤—ã–π –∞–≤—Ç–æ–º–∞—Ç",
                            "fr": "√©tal, √©talage, stand, kiosque",
                            "es": "quiosco, tenderete, puesto"
                        }
                    },
                    {
                        "id": 11,
                        "dir": "V",
                        "row": 0,
                        "col": 4,
                        "word_enc": "JUVCJUIzJTg0JUVCJTk4JUE1JUVCJUIzJTg0",
                        "hints": {
                            "en": "meteor; shooting star",
                            "ko": "Ïö∞Ï£ºÏóêÏÑú ÏßÄÍµ¨Î°ú Îì§Ïñ¥ÏôÄ Í≥µÍ∏∞Ïóê Î∂ÄÎî™Ï≥ê Î∞ùÏùÄ ÎπõÏùÑ ÎÇ¥Î©∞ Îñ®Ïñ¥ÏßÄÎäî Î¨ºÏ≤¥.",
                            "cn": "ÊµÅÊòü",
                            "jp": "„Çä„ÇÖ„ÅÜ„Åõ„ÅÑ„ÄêÊµÅÊòü„Äë„ÄÇ„Å™„Åå„Çå„Åº„Åó„ÄêÊµÅ„ÇåÊòü„Äë„ÄÇ„ÅÑ„Çì„Åõ„ÅÑ„ÄêÈöïÊòü„Äë",
                            "vn": "sao bƒÉng",
                            "id": "bintang jatuh, meteor ",
                            "ru": "–ø–∞–¥–∞—é—â–∞—è –∑–≤–µ–∑–¥–∞; –º–µ—Ç–µ–æ—Ä",
                            "fr": "√©toile filante, m√©t√©ore",
                            "es": "meteoro, estrella fugaz"
                        }
                    },
                    {
                        "id": 12,
                        "dir": "H",
                        "row": 1,
                        "col": 0,
                        "word_enc": "JUVCJUI5JUE4JUVBJUIwJTg0JUVCJUI2JTg4",
                        "hints": {
                            "en": "red light",
                            "ko": "ÍµêÏ∞®Î°úÎÇò Ìö°Îã®Î≥¥ÎèÑÏùò Ïã†Ìò∏Îì±ÏóêÏÑú, Î©àÏ∂îÎùºÎäî ÌëúÏãúÏùò Îπ®Í∞Ñ Î∂àÎπõ.",
                            "cn": "Á∫¢ÁÅØ",
                            "jp": "„ÅÇ„Åã„Åó„Çì„Åî„ÅÜ„ÄêËµ§‰ø°Âè∑„Äë",
                            "vn": "ƒë√®n ƒë·ªè",
                            "id": "lampu merah",
                            "ru": "–∫—Ä–∞—Å–Ω—ã–π —Å–≤–µ—Ç",
                            "fr": "feu rouge",
                            "es": "luz roja"
                        }
                    },
                    {
                        "id": 13,
                        "dir": "H",
                        "row": 0,
                        "col": 3,
                        "word_enc": "JUVBJUIwJTg4JUVCJUI5JTg0JUVDJTk0JUE4",
                        "hints": {
                            "en": "living skeleton; skeleton",
                            "ko": "(ÎÜÄÎ¶¨Îäî ÎßêÎ°ú) ÎºàÎßå ÎÇ®ÏùÄ Í≤ÉÍ∞ôÏù¥ Î™πÏãú ÎßàÎ•∏ ÏÇ¨Îûå.",
                            "cn": "ÊéíÈ™®ÔºåÁ´πÁ´ø",
                            "jp": "„ÇÑ„Åõ„Å£„ÅΩ„Å°„ÄêÁó©„Åõ„Å£„ÅΩ„Å°„Äë",
                            "vn": "b·ªô x∆∞∆°ng di ƒë·ªông, ng∆∞·ªùi g·∫ßy tr∆° x∆∞∆°ng",
                            "id": "si tulang, si kerempeng",
                            "ru": "—Å–∫–µ–ª–µ—Ç, –∫–æ–∂–∞ –¥–∞ –∫–æ—Å—Ç–∏",
                            "fr": "squelettique",
                            "es": "esqueleto, esquel√©tico"
                        }
                    },
                    {
                        "id": 14,
                        "dir": "V",
                        "row": 0,
                        "col": 0,
                        "word_enc": "JUVDJUE1JTkwJUVCJUJGJTk0",
                        "hints": {
                            "en": "tiny bit",
                            "ko": "(ÎπÑÏú†Ï†ÅÏúºÎ°ú) Í∑∏Îã§ÏßÄ Ï¢ãÏßÄ ÏïäÍ±∞ÎÇò ÌÅ¨Í∏∞Í∞Ä ÏûëÏùÄ Í≤É.",
                            "cn": "ÂæÆ‰πéÂÖ∂ÂæÆ",
                            "jp": "„Å°„Å£„ÅΩ„Åë",
                            "vn": "s·ª± b√© b·∫±ng c√°i ƒë·∫ßu tƒÉm",
                            "id": "(Tiada Penjelasan Arti)",
                            "ru": "–Ω–∏—á—Ç–æ–∂–Ω–∞—è –≤–µ—â—å; –ø—É—Å—Ç—è–∫",
                            "fr": "chose sans valeur, babiole",
                            "es": "peque√±ez, lo insignificante, mediocridad"
                        }
                    },
                    {
                        "id": 15,
                        "dir": "V",
                        "row": 6,
                        "col": 2,
                        "word_enc": "JUVCJTgxJTlEJUVCJThGJTk5",
                        "hints": {
                            "en": "kkeutdong; cuff",
                            "ko": "ÌïúÎ≥µ Ï†ÄÍ≥†Î¶¨ Ïò∑ÏÜåÎß§Ïùò ÎÅùÏóê Îã§Î•∏ Ï≤úÏùÑ ÎåÑ Î∂ÄÎ∂Ñ.",
                            "cn": "Èï∂Ëæπ",
                            "jp": "„Åè„Å°„Å¨„ÅÆ„ÄêÂè£Â∏É„Äë„ÄÇ„Åè„Å°„Åé„Çå„ÄêÂè£Âàá„Äë",
                            "vn": "g·∫•u tay √°o, c·ªï tay √°o",
                            "id": "manset",
                            "ru": "–º–∞–Ω–∂–µ—Ç–∞; –æ–±—à–ª–∞–≥",
                            "fr": "kkeutdong",
                            "es": "borde del pu√±o del hanbok"
                        }
                    },
                    {
                        "id": 16,
                        "dir": "V",
                        "row": 5,
                        "col": 4,
                        "word_enc": "JUVDJTg4JTk4JUVCJUEzJThDJUVDJThCJTlE",
                        "hints": {
                            "en": "completion ceremony",
                            "ko": "ÌïôÎ¨∏Ïù¥ÎÇò Í∏∞Ïà†ÏùÑ Î∞∞Ïö∞Îäî ÏùºÏ†ïÌïú Í≥ºÏ†ïÏùÑ ÎßàÏπú Í≤ÉÏùÑ Í∏∞ÎÖêÌïòÎäî ÏùòÏãù.",
                            "cn": "Áªì‰∏öÂºè",
                            "jp": "„Åó„ÇÖ„ÅÜ„Çä„Çá„ÅÜ„Åó„Åç„Äê‰øÆ‰∫ÜÂºè„Äë ",
                            "vn": "l·ªÖ b·∫ø gi·∫£ng",
                            "id": "upacara tamatan",
                            "ru": "—Ü–µ—Ä–µ–º–æ–Ω–∏—è –ø–æ —Å–ª—É—á–∞—é –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫—É—Ä—Å–∞ –æ–±—É—á–µ–Ω–∏—è",
                            "fr": "c√©r√©monie de remise des dipl√¥mes",
                            "es": "ceremonia de terminaci√≥n"
                        }
                    },
                    {
                        "id": 17,
                        "dir": "V",
                        "row": 4,
                        "col": 5,
                        "word_enc": "JUVCJUI5JUE4JUVCJTlFJTk4",
                        "hints": {
                            "en": "washing; laundry",
                            "ko": "ÎçîÎü¨Ïö¥ Ïò∑Ïù¥ÎÇò Ï≤ú Îì±ÏùÑ Î¨ºÏóê Îπ†Îäî Ïùº.",
                            "cn": "Ê¥óË°£ÔºåÊ¥óË°£Êúç",
                            "jp": "„Åõ„Çì„Åü„Åè„ÄêÊ¥óÊøØ„Äë„ÄÇ„ÅÇ„Çâ„ÅÑ„ÇÇ„ÅÆ„ÄêÊ¥ó„ÅÑÁâ©„Äë",
                            "vn": "s·ª± gi·∫∑t gi≈© ",
                            "id": "mencuci pakaian",
                            "ru": "—Å—Ç–∏—Ä–∫–∞ (–±–µ–ª—å—è)",
                            "fr": "lavage, lessive, blanchissage",
                            "es": "lavado de ropa"
                        }
                    },
                    {
                        "id": 18,
                        "dir": "H",
                        "row": 3,
                        "col": 6,
                        "word_enc": "JUVEJThGJUFDJUVDJUIwJUE5",
                        "hints": {
                            "en": "catching; grasping",
                            "ko": "Ïñ¥Îñ§ Í∏∞ÌöåÎÇò ÏùºÏùò ÎèåÏïÑÍ∞ÄÎäî ÏÉÅÌô©ÏùÑ ÏïåÏïÑÏ∞®Î¶º.",
                            "cn": "ÊçïÊçâÔºåÊäì‰Ωè",
                            "jp": "„Åª„Åù„Åè„ÄêÊçïÊçâ„Äë„ÄÇ„ÅØ„Åù„Åè„ÄêÊääÊçâ„Äë",
                            "vn": "s·ª± n·∫Øm b·∫Øt",
                            "id": "pengiraan, penaksiran",
                            "ru": "–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∫–∞; —É–ª—É—á–µ–Ω–∏–µ –º–æ–º–µ–Ω—Ç–∞",
                            "fr": "saisie, compr√©hension",
                            "es": "captura"
                        }
                    },
                    {
                        "id": 19,
                        "dir": "H",
                        "row": 1,
                        "col": 6,
                        "word_enc": "JUVCJTgyJTlDJUVEJTgzJTgw",
                        "hints": {
                            "en": "beating at random; pommeling",
                            "ko": "ÎßàÍµ¨ ÏπòÍ±∞ÎÇò ÎïåÎ¶º.",
                            "cn": "‰π±ÊâìÔºåÊö¥Êâì",
                            "jp": "„Çâ„Çì„Å†„Äê‰π±Êâì„Äë",
                            "vn": "·∫©u ƒë·∫£",
                            "id": "pukulan bertubi-tubi",
                            "ru": "(–Ω–µ—Ç —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–∞)",
                            "fr": "(Pas d'expression √©quivalente)",
                            "es": "paliza, zurra, soba, aporreo, azotamiento"
                        }
                    }
                ]
            }
        ];

        const UI_TEXT = {
            en: {
                title: "Daily Chosung Quiz",
                key_on: "‚å®Ô∏è Keyboard On",
                key_off: "‚å®Ô∏è Keyboard Off",
                btn_reveal: "üí° Reveal Answer",
                btn_hint: "üîç Hint (+10s)",
                btn_hide: "üôà Hide Answer",
                confirm_reveal: "Are you sure you want to reveal the answers?",
                header_h: "Horizontal",
                header_v: "Vertical",
                modal_title: "Success!",
                modal_desc: "You completed the puzzle!",
                modal_result: "Time: {m}m {s}s",
                modal_close: "Close",
                status_load: "Loading puzzle...",
                status_fail: "Failed to load puzzle.",
                status_nodata: "No puzzle data for today."
            },
            ko: {
                title: "Ïò§ÎäòÏùò Ï¥àÏÑ± ÌÄ¥Ï¶à",
                key_on: "‚å®Ô∏è ÏûêÌåê ÏºúÍ∏∞",
                key_off: "‚å®Ô∏è ÏûêÌåê ÎÅÑÍ∏∞",
                btn_reveal: "üí° Ï†ïÎãµ Î≥¥Í∏∞",
                btn_hint: "üîç ÌûåÌä∏ (+10Ï¥à)",
                btn_hide: "üôà Ï†ïÎãµ Í∞ÄÎ¶¨Í∏∞",
                confirm_reveal: "Ï†ïÎßê Ï†ïÎãµÏùÑ ÌôïÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?",
                header_h: "Í∞ÄÎ°ú",
                header_v: "ÏÑ∏Î°ú",
                modal_title: "ÏÑ±Í≥µ!",
                modal_desc: "Ïò§ÎäòÏùò ÌçºÏ¶êÏùÑ ÏôÑÏÑ±ÌñàÏäµÎãàÎã§!",
                modal_result: "Í±∏Î¶∞ ÏãúÍ∞Ñ: {m}Î∂Ñ {s}Ï¥à",
                modal_close: "Îã´Í∏∞",
                status_load: "ÌçºÏ¶êÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...",
                status_fail: "ÌçºÏ¶êÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.",
                status_nodata: "Ïò§ÎäòÏùò ÌçºÏ¶ê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§."
            },
            cn: {
                title: "‰ªäÊó•ÂàùÂ£∞ÊµãÈ™å",
                key_on: "‚å®Ô∏è ÊâìÂºÄÈîÆÁõò",
                key_off: "‚å®Ô∏è ÂÖ≥Èó≠ÈîÆÁõò",
                btn_reveal: "üí° ÊòæÁ§∫Á≠îÊ°à",
                btn_hint: "üîç ÊèêÁ§∫ (+10Áßí)",
                btn_hide: "üôà ÈöêËóèÁ≠îÊ°à",
                confirm_reveal: "ÊÇ®Á°ÆÂÆöË¶ÅÊòæÁ§∫Á≠îÊ°àÂêóÔºü",
                header_h: "Ê∞¥Âπ≥",
                header_v: "ÂûÇÁõ¥",
                modal_title: "ÊàêÂäüÔºÅ",
                modal_desc: "ÊÇ®ÂÆåÊàê‰∫Ü‰ªäÂ§©ÁöÑÊãºÂõæÔºÅ",
                modal_result: "Áî®Êó∂: {m}ÂàÜ {s}Áßí",
                modal_close: "ÂÖ≥Èó≠",
                status_load: "Ê≠£Âú®Âä†ËΩΩÊãºÂõæ...",
                status_fail: "Âä†ËΩΩÊãºÂõæÂ§±Ë¥•„ÄÇ",
                status_nodata: "‰ªäÂ§©Ê≤°ÊúâÊãºÂõæÊï∞ÊçÆ„ÄÇ"
            },
            jp: {
                title: "‰ªäÊó•„ÅÆÂàùÂ£∞„ÇØ„Ç§„Ç∫",
                key_on: "‚å®Ô∏è „Ç≠„Éº„Éú„Éº„ÉâË°®Á§∫",
                key_off: "‚å®Ô∏è „Ç≠„Éº„Éú„Éº„ÉâÈùûË°®Á§∫",
                btn_reveal: "üí° Á≠î„Åà„ÇíË¶ã„Çã",
                btn_hint: "üîç „Éí„É≥„Éà (+10Áßí)",
                btn_hide: "üôà Á≠î„Åà„ÇíÈö†„Åô",
                confirm_reveal: "Êú¨ÂΩì„Å´Á≠î„Åà„ÇíË¶ã„Åæ„Åô„ÅãÔºü",
                header_h: "Ê®™ (Horizontal)",
                header_v: "Á∏¶ (Vertical)",
                modal_title: "ÊàêÂäüÔºÅ",
                modal_desc: "„Éë„Ç∫„É´„ÇíÂÆåÊàê„Åï„Åõ„Åæ„Åó„ÅüÔºÅ",
                modal_result: "ÊâÄË¶ÅÊôÇÈñì: {m}ÂàÜ {s}Áßí",
                modal_close: "Èñâ„Åò„Çã",
                status_load: "„Éë„Ç∫„É´„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...",
                status_fail: "„Éë„Ç∫„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ",
                status_nodata: "‰ªäÊó•„ÅÆ„Éë„Ç∫„É´„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ"
            },
            vn: {
                title: "C√¢u ƒë·ªë Chosung h√†ng ng√†y",
                key_on: "‚å®Ô∏è B·∫≠t b√†n ph√≠m",
                key_off: "‚å®Ô∏è T·∫Øt b√†n ph√≠m",
                btn_reveal: "üí° Xem ƒë√°p √°n",
                btn_hint: "üîç G·ª£i √Ω (+10s)",
                btn_hide: "üôà ·∫®n ƒë√°p √°n",
                confirm_reveal: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xem ƒë√°p √°n kh√¥ng?",
                header_h: "Ngang",
                header_v: "D·ªçc",
                modal_title: "Th√†nh c√¥ng!",
                modal_desc: "B·∫°n ƒë√£ ho√†n th√†nh c√¢u ƒë·ªë!",
                modal_result: "Th·ªùi gian: {m} ph√∫t {s} gi√¢y",
                modal_close: "ƒê√≥ng",
                status_load: "ƒêang t·∫£i c√¢u ƒë·ªë...",
                status_fail: "Kh√¥ng t·∫£i ƒë∆∞·ª£c c√¢u ƒë·ªë.",
                status_nodata: "Kh√¥ng c√≥ d·ªØ li·ªáu c√¢u ƒë·ªë cho h√¥m nay."
            },
            id: {
                title: "Kuis Chosung Harian",
                key_on: "‚å®Ô∏è Buka Keyboard",
                key_off: "‚å®Ô∏è Tutup Keyboard",
                btn_reveal: "üí° Lihat Jawaban",
                btn_hint: "üîç Petunjuk (+10d)",
                btn_hide: "üôà Sembunyikan Jawaban",
                confirm_reveal: "Apakah Anda yakin ingin melihat jawabannya?",
                header_h: "Mendatar",
                header_v: "Menurun",
                modal_title: "Berhasil!",
                modal_desc: "Anda menyelesaikan teka-teki!",
                modal_result: "Waktu: {m}m {s}d",
                modal_close: "Tutup",
                status_load: "Memuat teka-teki...",
                status_fail: "Gagal memuat teka-teki.",
                status_nodata: "Tidak ada data teka-teki hari ini."
            },
            ru: {
                title: "–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞",
                key_on: "‚å®Ô∏è –í–∫–ª. –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É",
                key_off: "‚å®Ô∏è –í—ã–∫–ª. –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É",
                btn_reveal: "üí° –û—Ç–≤–µ—Ç",
                btn_hint: "üîç –ü–æ–¥—Å–∫–∞–∑–∫–∞ (+10—Å)",
                btn_hide: "üôà –°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç",
                confirm_reveal: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–≤–∏–¥–µ—Ç—å –æ—Ç–≤–µ—Ç?",
                header_h: "–ü–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏",
                header_v: "–ü–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏",
                modal_title: "–£—Å–ø–µ—Ö!",
                modal_desc: "–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫—É!",
                modal_result: "–í—Ä–µ–º—è: {m}–º {s}—Å",
                modal_close: "–ó–∞–∫—Ä—ã—Ç—å",
                status_load: "–ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏...",
                status_fail: "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ–ª–æ–≤–æ–ª–æ–º–∫—É.",
                status_nodata: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏."
            },
            fr: {
                title: "Quiz Chosung Quotidien",
                key_on: "‚å®Ô∏è Activer Clavier",
                key_off: "‚å®Ô∏è D√©sactiver Clavier",
                btn_reveal: "üí° Solution",
                btn_hint: "üîç Indice (+10s)",
                btn_hide: "üôà Masquer",
                confirm_reveal: "√ätes-vous s√ªr de vouloir voir la r√©ponse ?",
                header_h: "Horizontal",
                header_v: "Vertical",
                modal_title: "Succ√®s!",
                modal_desc: "Vous avez termin√© le puzzle !",
                modal_result: "Temps: {m}m {s}s",
                modal_close: "Fermer",
                status_load: "Chargement du puzzle...",
                status_fail: "√âchec du chargement.",
                status_nodata: "Pas de puzzle pour aujourd'hui."
            },
            es: {
                title: "Prueba Diaria Chosung",
                key_on: "‚å®Ô∏è Teclado On",
                key_off: "‚å®Ô∏è Teclado Off",
                btn_reveal: "üí° Soluci√≥n",
                btn_hint: "üîç Pista (+10s)",
                btn_hide: "üôà Ocultar",
                confirm_reveal: "¬øEst√°s seguro de que quieres ver la respuesta?",
                header_h: "Horizontal",
                header_v: "Vertical",
                modal_title: "¬°√âxito!",
                modal_desc: "¬°Completaste el rompecabezas!",
                modal_result: "Tiempo: {m}m {s}s",
                modal_close: "Cerrar",
                status_load: "Cargando rompecabezas...",
                status_fail: "Error al cargar.",
                status_nodata: "No hay datos para hoy."
            }
        };

        document.addEventListener('DOMContentLoaded', async () => {
            const dateEl = document.getElementById('date-display');
            const statusEl = document.getElementById('status-msg');
            const gameContainer = document.getElementById('game-board');
            const controls = document.getElementById('game-controls');

            currentLanguage = document.getElementById('language-select').value;
            updateUIText();

            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const todayStr = `${year}-${month}-${day}`;
            
            dateEl.textContent = todayStr;

            let allPuzzles = [];

            try {
                const response = await fetch('puzzles.json');
                if (!response.ok) throw new Error("Îç∞Ïù¥ÌÑ∞ ÌååÏùº Î°úÎìú Ïã§Ìå®");
                allPuzzles = await response.json();
            } catch (error) {
                console.warn("Fetch failed, using debug data:", error);
                allPuzzles = DEBUG_PUZZLE_DATA;
                // ÎîîÎ≤ÑÍπÖÏùÑ ÏúÑÌï¥ Ï≤´ Î≤àÏß∏ ÌçºÏ¶êÏùò ÎÇ†ÏßúÎ•º Ïò§ÎäòÎ°ú Í∞ïÏ†ú ÏÑ§Ï†ï
                if (allPuzzles.length > 0) allPuzzles[0].date = todayStr;
            }

            const todayPuzzle = allPuzzles.find(p => p.date === todayStr);

            if (todayPuzzle) {
                statusEl.style.display = 'none';
                gameContainer.style.display = 'flex';
                controls.style.display = 'flex';
                
                gridSize = todayPuzzle.gridSize || 8;
                initGame(todayPuzzle.puzzleData);
            } else {
                statusEl.textContent = UI_TEXT[currentLanguage].status_nodata;
                statusEl.style.color = "red";
            }
        });

        function startTimer() {
            stopTimer();
            timerSeconds = 0;
            isGameRunning = true;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
            }, 1000);
        }

        function resumeTimer() {
            if (isGameRunning) return;
            isGameRunning = true;
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
            }, 1000);
        }

        function stopTimer() {
            isGameRunning = false;
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimerDisplay() {
            const m = Math.floor(timerSeconds / 60).toString().padStart(2, '0');
            const s = (timerSeconds % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').textContent = `${m}:${s}`;
        }

        function getChosung(char) {
            const code = char.charCodeAt(0) - 44032;
            if (code > -1 && code < 11172) {
                return CHOSUNG_LIST[Math.floor(code / 588)];
            }
            return char;
        }

        function decodeData(data) {
            return data.map(item => {
                try {
                    const decodedWord = decodeURIComponent(atob(item.word_enc));
                    const chosungs = decodedWord.split('').map(getChosung).join('');
                    const hints = item.hints || { "en": item.hint || "No Hint" };
                    return { ...item, word: decodedWord, chosungs: chosungs, hints: hints };
                } catch (e) {
                    return { ...item, word: "ERROR", chosungs: "??", hints: {"en":"Error"} };
                }
            });
        }

        function changeLanguage() {
            const select = document.getElementById('language-select');
            currentLanguage = select.value;
            updateUIText();
            if (globalPuzzleData.length > 0) {
                renderHints(globalPuzzleData);
            }
        }

        function updateUIText() {
            const texts = UI_TEXT[currentLanguage] || UI_TEXT['en'];
            document.getElementById('ui-title').textContent = texts.title;
            document.getElementById('ui-header-h').textContent = texts.header_h;
            document.getElementById('ui-header-v').textContent = texts.header_v;
            document.getElementById('ui-modal-title').textContent = texts.modal_title;
            document.getElementById('ui-modal-desc').textContent = texts.modal_desc;
            document.getElementById('ui-modal-close').textContent = texts.modal_close;
            updateKeyboardButtonText();
            document.getElementById('reveal-btn').textContent = isRevealed ? texts.btn_hide : texts.btn_reveal;
            document.getElementById('hint-btn').textContent = texts.btn_hint;
        }

        function updateKeyboardButtonText() {
            const kb = document.getElementById('virtual-keyboard');
            const btn = document.getElementById('toggle-keyboard-btn');
            const texts = UI_TEXT[currentLanguage] || UI_TEXT['en'];

            if (kb.classList.contains('visible')) {
                btn.textContent = texts.key_off;
            } else {
                btn.textContent = texts.key_on;
            }
        }

        function initGame(rawData) {
            globalPuzzleData = decodeData(rawData);
            
            globalGridMap = Array.from({ length: gridSize }, () => Array.from({ length: gridSize }, () => ({
                active: false,
                answerChosung: null, 
                fullSyllables: new Set(),
                clueNum: null,
                inputElement: null
            })));

            let startPositions = Array.from({ length: gridSize }, () => Array(gridSize).fill(false));

            globalPuzzleData.forEach((item) => {
                startPositions[item.row][item.col] = true;
                let r = item.row;
                let c = item.col;
                for (let i = 0; i < item.word.length; i++) {
                    if (r < gridSize && c < gridSize) {
                        globalGridMap[r][c].active = true;
                        globalGridMap[r][c].answerChosung = item.chosungs[i];
                        globalGridMap[r][c].fullSyllables.add(item.word[i]);
                    }
                    if (item.dir === 'H') c++; else r++;
                }
            });

            let currentClueNum = 1;
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    if (startPositions[r][c]) {
                        globalGridMap[r][c].clueNum = currentClueNum;
                        globalPuzzleData.forEach(item => {
                            if (item.row === r && item.col === c) {
                                item.assignedNum = currentClueNum;
                            }
                        });
                        currentClueNum++;
                    }
                }
            }

            const gridEl = document.getElementById('grid');
            gridEl.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            gridEl.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
            gridEl.innerHTML = ''; 

            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const cellData = globalGridMap[r][c];
                    const cellEl = document.createElement('div');
                    cellEl.className = 'cell';

                    if (!cellData.active) {
                        cellEl.classList.add('blocked');
                        cellEl.textContent = '.';
                    } else {
                        if (cellData.clueNum !== null) {
                            const numSpan = document.createElement('span');
                            numSpan.className = 'clue-number';
                            numSpan.textContent = cellData.clueNum;
                            cellEl.appendChild(numSpan);
                        }

                        const input = document.createElement('input');
                        input.type = 'text';
                        
                        // [ÏàòÏ†ïÎê®] Ï¥àÍ∏∞ ÏÉÅÌÉúÏóêÏÑúÎäî Í∞ÄÏÉÅ ÌÇ§Î≥¥ÎìúÍ∞Ä Í∫ºÏ†∏ ÏûàÏúºÎØÄÎ°ú ÏãúÏä§ÌÖú ÌÇ§Î≥¥Îìú ÌôúÏÑ±Ìôî (inputmode="none" Ï†úÍ±∞)
                        // input.setAttribute("inputmode", "none"); 
                        
                        input.dataset.ans = cellData.answerChosung;
                        input.setAttribute("autocomplete", "off");
                        
                        input.addEventListener('focus', (e) => {
                            lastFocusedInput = e.target;
                            e.target.select();
                        });
                        input.addEventListener('click', function() { this.select(); });

                        input.addEventListener('input', (e) => {
                            const val = e.target.value;
                            const consonants = val.match(/[„Ñ±-„Öé]/g);
                            if (consonants && consonants.length > 0) {
                                e.target.value = consonants[consonants.length - 1];
                            } else {
                                e.target.value = '';
                            }
                            checkCell(e.target);
                            checkWinCondition();
                        });

                        input.addEventListener('keydown', (e) => handleNavigation(e, r, c));

                        cellEl.appendChild(input);
                        cellData.inputElement = input;
                    }
                    gridEl.appendChild(cellEl);
                }
            }

            renderHints(globalPuzzleData);
            createVirtualKeyboard();
            startTimer();
        }

        function renderHints(puzzleData) {
            const hintsH = document.getElementById('hints-horizontal');
            const hintsV = document.getElementById('hints-vertical');
            hintsH.innerHTML = '';
            hintsV.innerHTML = '';

            const horizItems = puzzleData.filter(i => i.dir === 'H').sort((a, b) => a.assignedNum - b.assignedNum);
            const vertItems = puzzleData.filter(i => i.dir === 'V').sort((a, b) => a.assignedNum - b.assignedNum);

            function getHintText(item) {
                if (item.hints[currentLanguage]) return item.hints[currentLanguage];
                if (item.hints['en']) return item.hints['en'];
                return Object.values(item.hints)[0] || "No Hint";
            }

            horizItems.forEach(item => {
                hintsH.innerHTML += `<div class="clue-item"><strong>${item.assignedNum}.</strong> ${getHintText(item)}</div>`;
            });

            vertItems.forEach(item => {
                hintsV.innerHTML += `<div class="clue-item"><strong>${item.assignedNum}.</strong> ${getHintText(item)}</div>`;
            });
        }

        function createVirtualKeyboard() {
            const keyboardContainer = document.getElementById('virtual-keyboard');
            keyboardContainer.innerHTML = ''; 

            CHOSUNG_LIST.forEach(char => {
                const btn = document.createElement('button');
                btn.className = 'key-btn';
                btn.textContent = char;
                btn.addEventListener('mousedown', (e) => {
                    e.preventDefault(); 
                    if (lastFocusedInput) {
                        lastFocusedInput.value = char;
                        lastFocusedInput.dispatchEvent(new Event('input'));
                    }
                });
                keyboardContainer.appendChild(btn);
            });
        }

        // [ÏàòÏ†ïÎê®] ÌÜ†Í∏Ä Ïãú Î™®Îì† inputÏùò inputmode ÏÜçÏÑ± Ï†úÏñ¥
        function toggleKeyboard() {
            const kb = document.getElementById('virtual-keyboard');
            const btn = document.getElementById('toggle-keyboard-btn');
            kb.classList.toggle('visible');
            btn.classList.toggle('active');
            updateKeyboardButtonText();

            // Í∞ÄÏÉÅ ÌÇ§Î≥¥Îìú ÏÉÅÌÉúÏóê Îî∞Îùº ÏãúÏä§ÌÖú ÌÇ§Î≥¥Îìú Ï†úÏñ¥
            const inputs = document.querySelectorAll('.cell input');
            const isVisible = kb.classList.contains('visible');

            inputs.forEach(input => {
                if (isVisible) {
                    // Í∞ÄÏÉÅ ÌÇ§Î≥¥Îìú ÏºúÏßê -> ÏãúÏä§ÌÖú ÌÇ§Î≥¥Îìú ÎÅÑÍ∏∞
                    input.setAttribute('inputmode', 'none');
                } else {
                    // Í∞ÄÏÉÅ ÌÇ§Î≥¥Îìú Í∫ºÏßê -> ÏãúÏä§ÌÖú ÌÇ§Î≥¥Îìú ÏºúÍ∏∞ (ÏÜçÏÑ± Ï†úÍ±∞)
                    input.removeAttribute('inputmode');
                }
            });
        }

        function useHint() {
            if (isRevealed || !isGameRunning) return;

            let targetItem = null;

            // Try to find word at focused cell first
            if (lastFocusedInput) {
                let focusedR = -1, focusedC = -1;
                outer: for(let r=0; r<gridSize; r++) {
                    for(let c=0; c<gridSize; c++) {
                        if (globalGridMap[r][c].inputElement === lastFocusedInput) {
                            focusedR = r;
                            focusedC = c;
                            break outer;
                        }
                    }
                }

                if (focusedR !== -1) {
                    const wordsAtCell = globalPuzzleData.filter(item => {
                        if (item.dir === 'H') {
                            return item.row === focusedR && focusedC >= item.col && focusedC < item.col + item.word.length;
                        } else {
                            return item.col === focusedC && focusedR >= item.row && focusedR < item.row + item.word.length;
                        }
                    });

                    for (const item of wordsAtCell) {
                        if (!isWordComplete(item)) {
                            targetItem = item;
                            break;
                        }
                    }
                }
            }

            if (!targetItem) {
                targetItem = globalPuzzleData.find(item => !isWordComplete(item));
            }

            if (targetItem) {
                fillWord(targetItem);
                timerSeconds += 10;
                updateTimerDisplay();
                checkWinCondition();
            }
        }

        function isWordComplete(item) {
            let r = item.row;
            let c = item.col;
            for (let i = 0; i < item.word.length; i++) {
                const cell = globalGridMap[r][c];
                if (cell.inputElement.value !== cell.answerChosung) return false;
                if (item.dir === 'H') c++; else r++;
            }
            return true;
        }

        function fillWord(item) {
            let r = item.row;
            let c = item.col;
            for (let i = 0; i < item.word.length; i++) {
                const cell = globalGridMap[r][c];
                cell.inputElement.value = cell.answerChosung;
                checkCell(cell.inputElement);
                if (item.dir === 'H') c++; else r++;
            }
        }

        function revealAllAnswers() {
            const texts = UI_TEXT[currentLanguage] || UI_TEXT['en'];
            const btn = document.getElementById('reveal-btn');
            const inputs = document.querySelectorAll('.cell input');

            if (!isRevealed) {
                if (!confirm(texts.confirm_reveal)) return;

                wasTimerRunning = isGameRunning;
                stopTimer();
                
                savedUserInputs = [];
                inputs.forEach(input => {
                    savedUserInputs.push(input.value);
                    input.value = input.dataset.ans;
                    input.readOnly = true;
                    checkCell(input);
                });
                
                isRevealed = true;
                btn.textContent = texts.btn_hide;
            } else {
                inputs.forEach((input, index) => {
                    input.value = savedUserInputs[index];
                    input.readOnly = false;
                    checkCell(input);
                });

                if (wasTimerRunning) resumeTimer();
                isRevealed = false;
                btn.textContent = texts.btn_reveal;
            }
        }

        function checkCell(input) {
            const val = input.value.trim();
            const parent = input.parentElement;
            parent.classList.remove('correct', 'wrong');
            if (val === '') return;
            
            if (val === input.dataset.ans) {
                parent.classList.add('correct');
            } else {
                parent.classList.add('wrong');
            }
        }

        function checkWinCondition() {
            let inputs = document.querySelectorAll('.cell input');
            if (inputs.length === 0) return;
            let allCorrect = true;
            for (let input of inputs) {
                if (input.value !== input.dataset.ans) {
                    allCorrect = false;
                    break;
                }
            }
            if (allCorrect) {
                stopTimer();
                document.activeElement.blur();
                setTimeout(revealAnswers, 100);
            }
        }

        function revealAnswers() {
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const cellData = globalGridMap[r][c];
                    if (cellData.active && cellData.inputElement) {
                        const input = cellData.inputElement;
                        const parent = input.parentElement;
                        const finalText = Array.from(cellData.fullSyllables).join('/');
                        input.remove();
                        const textDiv = document.createElement('div');
                        textDiv.className = 'revealed-text';
                        textDiv.textContent = finalText;
                        parent.appendChild(textDiv);
                    }
                }
            }
            
            const texts = UI_TEXT[currentLanguage] || UI_TEXT['en'];
            const m = Math.floor(timerSeconds / 60);
            const s = timerSeconds % 60;
            const resultMsg = texts.modal_result.replace('{m}', m).replace('{s}', s);
            document.getElementById('ui-modal-time').textContent = resultMsg;

            document.getElementById('congrats-modal').style.display = 'flex';
        }

        function handleNavigation(e, r, c) {
            let nextR = r, nextC = c;
            if (e.key === 'ArrowUp') nextR--;
            else if (e.key === 'ArrowDown') nextR++;
            else if (e.key === 'ArrowLeft') nextC--;
            else if (e.key === 'ArrowRight') nextC++;
            else return;

            if (nextR >= 0 && nextR < gridSize && nextC >= 0 && nextC < gridSize) {
                const nextCell = globalGridMap[nextR][nextC];
                if (nextCell.active && nextCell.inputElement) {
                    e.preventDefault();
                    nextCell.inputElement.focus();
                }
            }
        }
    </script>
</body>
</html>