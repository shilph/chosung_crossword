<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global Chosung Crossword</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --grid-bg: #333;
            --cell-bg: #fff;
            --cell-blocked: #ddd;
            --correct-color: #d4edda;
            --wrong-color: #f8d7da;
            --input-text: #333;
            --key-bg: #fff;
            --key-shadow: #bbb;
        }

        body {
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            padding-bottom: 220px;
            margin: 0;
            touch-action: manipulation;
            -webkit-text-size-adjust: 100%;
        }

        h1 { margin-bottom: 5px; color: #333; font-size: 1.5rem; }
        #date-display { margin-bottom: 10px; font-size: 1rem; color: #666; }
        
        #timer-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 20px;
            font-family: monospace;
            background: #e9ecef;
            padding: 5px 15px;
            border-radius: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-style {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background 0.2s;
            height: 36px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
        }
        .btn-style:hover { background-color: #0056b3; }
        .btn-style.active { background-color: #004494; box-shadow: inset 0 2px 5px rgba(0,0,0,0.3); }

        select.btn-style {
            appearance: none;
            padding-right: 30px;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right .7em top 50%;
            background-size: .65em auto;
        }
        select.btn-style option { background-color: white; color: #333; }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 1000px;
            width: 100%;
        }

        #status-msg {
            font-size: 1.2rem;
            color: #555;
            margin-top: 50px;
            text-align: center;
        }

        .crossword-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            aspect-ratio: 1 / 1;
            width: 100%;
            max-width: 380px;
            gap: 2px;
            background-color: var(--grid-bg);
            border: 4px solid var(--grid-bg);
            border-radius: 4px;
            box-sizing: border-box;
        }

        .cell {
            background-color: var(--cell-bg);
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .cell.blocked { background-color: var(--cell-blocked); }
        .cell:focus-within { box-shadow: inset 0 0 0 3px #4a90e2; z-index: 10; }

        .cell input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: clamp(14px, 5vw, 22px); 
            font-weight: bold;
            background: transparent;
            color: var(--input-text);
            padding: 0;
            outline: none;
            border-radius: 0;
            caret-color: transparent; 
        }
        .cell input::selection { background: rgba(0, 0, 0, 0.1); }
        .cell.correct { background-color: var(--correct-color) !important; }
        .cell.wrong { background-color: var(--wrong-color) !important; }

        .clue-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 10px;
            line-height: 1;
            color: #555;
            font-weight: bold;
            pointer-events: none;
            z-index: 5;
        }

        .revealed-text {
            font-size: clamp(10px, 4vw, 16px);
            font-weight: bold;
            color: #0056b3;
            text-align: center;
            line-height: 1.2;
            word-break: keep-all;
        }

        .clues-section {
            display: flex;
            gap: 20px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            box-sizing: border-box;
            font-size: 14px;
        }

        .clue-col { flex: 1; }
        .clue-col h3 { border-bottom: 2px solid #ddd; padding-bottom: 5px; margin-top: 0; }
        .clue-item { margin-bottom: 8px; line-height: 1.4; }
        .clue-item strong { color: #007bff; margin-right: 5px; }

        #virtual-keyboard {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #dcdcdc;
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none; 
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
            z-index: 1000;
            box-sizing: border-box;
        }
        #virtual-keyboard.visible { display: flex; }

        .key-btn {
            background-color: var(--key-bg);
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 0 var(--key-shadow);
            font-size: 18px;
            font-weight: bold;
            color: #333;
            width: 40px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }
        .key-btn:active { transform: translateY(2px); box-shadow: none; }

        #congrats-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 300px;
        }
        .modal-content h2 { color: #28a745; margin: 0 0 10px 0; font-size: 28px; }
        #ui-modal-time { color: #0056b3; font-weight: bold; margin-bottom: 20px; font-size: 1.2rem; }
        .close-btn {
            margin-top: 10px;
            padding: 10px 20px;
            background: #333;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }

        @media (max-width: 600px) {
            body { padding: 10px; padding-bottom: 220px; }
            .crossword-board {
                width: 95%; max-width: 380px; gap: 1px; border-width: 2px;
            }
            .clue-number { font-size: 8px; top: 1px; left: 1px; }
            .clues-section { flex-direction: column; gap: 20px; }
            .key-btn { width: 13%; height: 45px; margin-bottom: 5px; font-size: 16px; }
        }
    </style>
</head>
<body>

    <h1 id="ui-title">Ïò§ÎäòÏùò Ï¥àÏÑ± ÌÄ¥Ï¶à</h1>
    <div id="date-display">Loading...</div>
    
    <div id="timer-display">00:00</div>

    <div class="controls" id="game-controls" style="display:none;">
        <select id="language-select" class="btn-style" onchange="changeLanguage()">
            <option value="en" selected>üá∫üá∏ English</option>
            <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
            <option value="cn">üá®üá≥ ‰∏≠Êñá</option>
            <option value="jp">üáØüáµ Êó•Êú¨Ë™û</option>
            <option value="vn">üáªüá≥ Ti·∫øng Vi·ªát</option>
            <option value="id">üáÆüá© Indonesia</option>
            <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
            <option value="fr">üá´üá∑ Fran√ßais</option>
            <option value="es">üá™üá∏ Espa√±ol</option>
        </select>
        
        <button id="toggle-keyboard-btn" class="btn-style" onclick="toggleKeyboard()">‚å®Ô∏è ÏûêÌåê ÏºúÍ∏∞</button>
        <button id="reveal-btn" class="btn-style" onclick="revealAllAnswers()">üí° Ï†ïÎãµ Î≥¥Í∏∞</button>
    </div>

    <div id="status-msg">Ïò§ÎäòÏùò ÌçºÏ¶êÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</div>

    <div class="game-container" id="game-board" style="display:none;">
        <div id="grid" class="crossword-board"></div>

        <div class="clues-section">
            <div class="clue-col">
                <h3 id="ui-header-h">Í∞ÄÎ°ú (Horizontal)</h3>
                <div id="hints-horizontal"></div>
            </div>
            <div class="clue-col">
                <h3 id="ui-header-v">ÏÑ∏Î°ú (Vertical)</h3>
                <div id="hints-vertical"></div>
            </div>
        </div>
    </div>

    <div id="virtual-keyboard"></div>

    <div id="congrats-modal">
        <div class="modal-content">
            <h2 id="ui-modal-title">ÏÑ±Í≥µ!</h2>
            <p id="ui-modal-desc">Ïò§ÎäòÏùò ÌçºÏ¶êÏùÑ ÏôÑÏÑ±ÌñàÏäµÎãàÎã§!</p>
            <p id="ui-modal-time"></p>
            <button id="ui-modal-close" class="close-btn" onclick="document.getElementById('congrats-modal').style.display='none'">Îã´Í∏∞</button>
        </div>
    </div>

    <script>
        let globalGridMap = [];
        let gridSize = 8;
        let lastFocusedInput = null; 
        let globalPuzzleData = []; 
        let currentLanguage = 'en'; 
        
        let timerSeconds = 0;
        let timerInterval = null;
        let isGameRunning = false;
        let isRevealed = false;
        let savedUserInputs = [];
        let wasTimerRunning = false;

        const CHOSUNG_LIST = ['„Ñ±','„Ñ≤','„Ñ¥','„Ñ∑','„Ñ∏','„Ñπ','„ÖÅ','„ÖÇ','„ÖÉ','„ÖÖ','„ÖÜ','„Öá','„Öà','„Öâ','„Öä','„Öã','„Öå','„Öç','„Öé'];

        const DEBUG_PUZZLE_DATA = [
            {
                "date": "2026-01-07",
                "gridSize": 8,
                "puzzleData": [
                    {
                        "id": 1,
                        "dir": "V",
                        "row": 2,
                        "col": 3,
                        "word_enc": "JUVCJUFBJUE5JUVCJUE3JTg4JUVCJUE2JTg0",
                        "hints": {
                            "en": "thirst; desire",
                            "ko": "Ïñ¥Îñ§ Í≤ÉÏùÑ Î™πÏãú Î∞îÎûå.",
                            "cn": "Ê∏¥ÊúõÔºåÊ∏¥Ê±Ç",
                            "jp": "„Åã„Çè„Åç„ÄêÊ∏á„Åç„Äë„ÄÇ„Åã„Å§„Åº„ÅÜ„ÄêÊ∏áÊúõ„Äë",
                            "vn": "s·ª± khao kh√°t",
                            "id": "kehausan",
                            "ru": "–∂–∞–∂–¥–∞; —Å—Ç—Ä–∞—Å—Ç–Ω–æ–µ –∂–µ–ª–∞–Ω–∏–µ",
                            "fr": "soif, envie, d√©sir",
                            "es": "sed, anhelo, ansiedad"
                        }
                    },
                    {
                        "id": 2,
                        "dir": "H",
                        "row": 3,
                        "col": 1,
                        "word_enc": "JUVCJUI2JTgxJUVDJTk1JTg0JUVCJUE5JTk0JUVCJUE2JUFDJUVDJUI5JUI0",
                        "hints": {
                            "en": "North America",
                            "ko": "ÏïÑÎ©îÎ¶¨Ïπ¥ ÎåÄÎ•ôÏùò Î∂ÅÎ∂Ä.",
                            "cn": "ÂåóÁæéÊ¥≤ÔºåÂåóÁæé",
                            "jp": "„Åç„Åü„Ç¢„É°„É™„Ç´„ÄêÂåó„Ç¢„É°„É™„Ç´„Äë",
                            "vn": "B·∫Øc M·ªπ",
                            "id": "Amerika Utara",
                            "ru": "–°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞",
                            "fr": "Am√©rique du Nord",
                            "es": "Am√©rica del Norte, Norteam√©rica "
                        }
                    },
                    {
                        "id": 3,
                        "dir": "V",
                        "row": 3,
                        "col": 1,
                        "word_enc": "JUVCJUI2JTgwJUVDJUE3JTgwJUVCJUI2JTg4JUVDJThCJTlEJUVBJUIwJTg0",
                        "hints": {
                            "en": "unknowing instant",
                            "ko": "ÏÉùÍ∞ÅÌïòÏßÄÎèÑ Î™ªÌïòÍ≥† ÏïåÏßÄÎèÑ Î™ªÌïòÎäî ÏÇ¨Ïù¥.",
                            "cn": "‰∏çÁü•‰∏çËßâÈó¥ÔºåÊó†ÊÑèÈó¥",
                            "jp": "(ÂØæË®≥Ë™ûÁÑ°„Åó)",
                            "vn": "trong l√∫c kh√¥ng h·ªÅ hay bi·∫øt",
                            "id": "saat tak terduga, saat lengah, saat lalai",
                            "ru": "(–Ω–µ—Ç —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–∞)",
                            "fr": "(n.) inconsciemment, √† son insu",
                            "es": "inconsciencia, desconocimiento "
                        }
                    },
                    {
                        "id": 4,
                        "dir": "H",
                        "row": 7,
                        "col": 0,
                        "word_enc": "JUVDJTlEJUJDJUVBJUIwJTgwJUVDJUExJUIx",
                        "hints": {
                            "en": "family; the whole family",
                            "ko": "Ìïú ÏßëÏïàÏùò Í∞ÄÏ°±. ÎòêÎäî Ïò® Í∞ÄÏ°±.",
                            "cn": "‰∏ÄÂÆ∂Ôºå‰∏ÄÂÆ∂‰∫∫",
                            "jp": "„ÅÑ„Å£„Åã„Äê‰∏ÄÂÆ∂„Äë„ÄÇ„ÅÑ„Å°„Åã„Åû„Åè„Äê‰∏ÄÂÆ∂Êóè„Äë",
                            "vn": "m·ªôt gia ƒë√¨nh",
                            "id": "keluarga, seluruh keluarga",
                            "ru": "–æ–¥–Ω–∞ —Å–µ–º—å—è",
                            "fr": "toute la famille, clan famillial, toute une famille",
                            "es": "una familia"
                        }
                    },
                    {
                        "id": 5,
                        "dir": "H",
                        "row": 5,
                        "col": 0,
                        "word_enc": "JUVCJThCJUI0JUVCJUIxJTgzJUVCJThDJTgw",
                        "hints": {
                            "en": "tobacco pipe",
                            "ko": "Îã¥Î∞∞Î•º ÌîºÏö∞Îäî Îç∞ Ïì∞Îäî Í∏∞Íµ¨.",
                            "cn": "ÁÉüË¢ã",
                            "jp": "„Ç≠„Çª„É´„Éª„Åà„Çì„Åã„Çì„ÄêÁÖôÁÆ°„ÉªÁÉüÁÆ°„Äë„ÄÇ„Éë„Ç§„Éó",
                            "vn": "t·∫©u",
                            "id": "pipa rokok",
                            "ru": "—Ç—Ä—É–±–∫–∞",
                            "fr": "pipe",
                            "es": "pipa, boquilla, cachimba"
                        }
                    },
                    {
                        "id": 6,
                        "dir": "V",
                        "row": 1,
                        "col": 5,
                        "word_enc": "JUVCJUIwJTk0JUVDJThBJUE0JUVDJUJDJTkz",
                        "hints": {
                            "en": "basket",
                            "ko": "ÎåÄÎÇòÎ¨¥, Ïã∏Î¶¨, Î≤ÑÎì§Í∞ÄÏßÄ Îì±ÏùÑ ÏóÆÏñ¥ÏÑú ÎßåÎì†, Î∞îÎã•Î≥¥Îã§ ÏúÑÏ™ΩÏù¥ Îçî Î≤åÏñ¥ÏßÑ ÌÅ∞ Í∑∏Î¶á.",
                            "cn": "ÁØÆÔºåÁØìÔºåÁ≠ê",
                            "jp": "„Éê„Çπ„Ç±„ÉÉ„Éà",
                            "vn": "r·ªï",
                            "id": "basket, keranjang",
                            "ru": "(–±–∞—Å–∫–µ—Ç–±–æ–ª—å–Ω–∞—è) –∫–æ—Ä–∑–∏–Ω–∞",
                            "fr": "panier",
                            "es": "cesto, canasta"
                        }
                    },
                    {
                        "id": 7,
                        "dir": "H",
                        "row": 1,
                        "col": 5,
                        "word_enc": "JUVCJUI2JTg4JUVCJUFDJUI4JUVCJUIyJTk1",
                        "hints": {
                            "en": "unwritten law",
                            "ko": "Î¨∏ÏÑúÏùò ÌòïÏãùÏùÑ Í∞ñÏ∂îÍ≥† ÏûàÏßÄÎäî ÏïäÏúºÎÇò Ïò§Îûú Í¥ÄÏäµÏù¥ÎÇò Ïù¥Ï†ÑÏùò ÌåêÍ≤∞ Îì±ÏùÑ Î∞îÌÉïÏúºÎ°ú ÌïòÏó¨ Ï°¥Ïû¨ÌïòÎäî Î≤ï.",
                            "cn": "‰∏çÊàêÊñáÊ≥ï",
                            "jp": "„Åµ„Å∂„Çì„Åª„ÅÜ„Äê‰∏çÊñáÊ≥ï„Äë„ÄÇ„Åµ„Å∂„Çì„Çä„Å§„Äê‰∏çÊñáÂæã„Äë",
                            "vn": "lu·∫≠t b·∫•t th√†nh vƒÉn",
                            "id": "hukum adat, hukum tidak tertulis",
                            "ru": "–Ω–µ–ø–∏—Å–∞–Ω—ã–π –∑–∞–∫–æ–Ω",
                            "fr": "loi non √©crite",
                            "es": "derecho com√∫n "
                        }
                    },
                    {
                        "id": 8,
                        "dir": "V",
                        "row": 1,
                        "col": 7,
                        "word_enc": "JUVCJUI2JTg4JUVCJThCJUE4JUVBJUI1JUFEJUVBJUIwJTgw",
                        "hints": {
                            "en": "divided country",
                            "ko": "Î≥∏Îûò ÌïòÎÇòÏòÄÎäîÎç∞ ÌÜµÏπò Ïù¥Îç∞Ïò¨Î°úÍ∏∞Í∞Ä Îã§Î•∏ Îëò Ïù¥ÏÉÅÏùò Ï†ïÎ∂ÄÎ°ú ÎÇòÎàÑÏñ¥ÏßÑ Íµ≠Í∞Ä.",
                            "cn": "ÂàÜË£ÇÁöÑÂõΩÂÆ∂",
                            "jp": "„Å∂„Çì„Å†„Çì„Åì„Å£„Åã„ÄêÂàÜÊñ≠ÂõΩÂÆ∂„Äë",
                            "vn": "Qu·ªëc gia b·ªã chia c·∫Øt",
                            "id": "negara terpisah, negara terbelah",
                            "ru": "—Ä–∞–∑–¥–µ–ª—ë–Ω–Ω–æ–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ",
                            "fr": "pays divis√©",
                            "es": "pa√≠s dividido, naci√≥n dividida"
                        }
                    },
                    {
                        "id": 9,
                        "dir": "V",
                        "row": 1,
                        "col": 3,
                        "word_enc": "JUVCJTgxJTlEJUVCJUE3JTg4JUVCJUFDJUI0JUVCJUE2JUFD",
                        "hints": {
                            "en": "finish; completion",
                            "ko": "ÏùºÏùò ÎßàÏßÄÎßâ Í≥ºÏ†ïÏù¥ÎÇò ÎÇ¥Ïö©ÏùÑ ÎÅùÎß∫Îäî Ïùº.",
                            "cn": "ÁªìÂ∞æÔºåÊî∂Â∞æ",
                            "jp": "„Åó„ÅÇ„Åí„Äê‰ªï‰∏ä„Åí„Äë„ÄÇ„Åó„ÇÅ„Åè„Åè„Çä„ÄêÁ∑†„ÇÅÊã¨„Çä„Äë„ÄÇ„Åë„Å£„Å°„ÇÉ„Åè„ÄêÊ±∫ÁùÄ„Äë„ÄÇ„Åó„ÇÖ„ÅÜ„Åë„Å§„ÄêÁµÇÁµê„Äë",
                            "vn": "s·ª± k·∫øt th√∫c, s·ª± t·ªïng k·∫øt  ",
                            "id": "akhir, penutupan, kesimpulan",
                            "ru": "–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ",
                            "fr": "finition, finalisation, finissage, fini, derni√®re touche, conclusion, derni√®re √©tape",
                            "es": "acabado, retoque"
                        }
                    },
                    {
                        "id": 10,
                        "dir": "H",
                        "row": 1,
                        "col": 1,
                        "word_enc": "JUVCJUE3JTkwJUVCJThDJTgwJUVBJUJFJUI4",
                        "hints": {
                            "en": "retort",
                            "ko": "ÏÉÅÎåÄÎ∞©Ïùò ÎßêÏùÑ Îì£Í≥† Í∑∏ÎåÄÎ°ú Î∞õÏïÑÎì§Ïù¥ÏßÄ ÏïäÍ≥† Î∞îÎ°ú ÏûêÏã†Ïùò ÏùòÍ≤¨Ïù¥ÎÇò ÏÉùÍ∞ÅÏùÑ ÎßêÌï®. ÎòêÎäî Í∑∏ Îßê.",
                            "cn": "È°∂Âò¥ÔºåÂèçÈ©≥",
                            "jp": "„ÅÑ„ÅÑ„Åã„Åà„Åó„ÄêË®Ä„ÅÑËøî„Åó„Äë„ÄÇ„Åè„Å°„Åî„Åü„Åà„ÄêÂè£Á≠î„Åà„Äë",
                            "vn": "s·ª± c√£i l·∫°i, s·ª± ph·∫£n b√°c ",
                            "id": "sangkalan, sanggahan, timpalan",
                            "ru": "–≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ",
                            "fr": "riposte, r√©plique, r√©ponse",
                            "es": "r√©plica"
                        }
                    },
                    {
                        "id": 11,
                        "dir": "H",
                        "row": 4,
                        "col": 6,
                        "word_enc": "JUVDJUExJUIwJUVBJUIwJTgx",
                        "hints": {
                            "en": "sculpture",
                            "ko": "Ïû¨Î£åÎ•º ÍπéÍ≥† ÏÉàÍ∏∞Í±∞ÎÇò ÎπöÏñ¥ÏÑú ÏûÖÏ≤¥Ï†ÅÏù∏ Î™®ÏñëÏùÑ ÎßåÎì¶. ÎòêÎäî Í∑∏Îü∞ ÎØ∏Ïà†.",
                            "cn": "ÈõïÂàª",
                            "jp": "„Å°„Çá„ÅÜ„Åì„Åè„ÄêÂΩ´Âàª„Äë",
                            "vn": "vi·ªác t·∫°c, vi·ªác ƒëi√™u kh·∫Øc, ngh·ªá thu·∫≠t ƒëi√™u kh·∫Øc",
                            "id": "pahatan, ukiran, patung",
                            "ru": "–°–∫—É–ª—å–ø—Ç—É—Ä–∞; –≥—Ä–∞–≤–∏—Ä–æ–≤–∫–∞; —Ä–µ–∑—å–±–∞",
                            "fr": "sculpture, gravure",
                            "es": "escultura, grabado, talla"
                        }
                    },
                    {
                        "id": 12,
                        "dir": "V",
                        "row": 4,
                        "col": 6,
                        "word_enc": "JUVDJUE3JTgwJUVDJUE3JTgwJUVDJTlDJUE4",
                        "hints": {
                            "en": "approval rating",
                            "ko": "ÏÑ†Í±∞ Îì±ÏóêÏÑú Ìà¨ÌëúÌïòÎäî ÏÇ¨ÎûåÎì§Ïù¥ Ïñ¥Îñ§ ÌõÑÎ≥¥Î•º ÏßÄÏßÄÌïòÎäî ÎπÑÏú®.",
                            "cn": "ÊîØÊåÅÁéá",
                            "jp": "„Åó„Åò„Çä„Å§„ÄêÊîØÊåÅÁéá„Äë ",
                            "vn": "t·ª∑ l·ªá t√°n th√†nh, t·ª∑ l·ªá ·ªßng h·ªô",
                            "id": "persentase dukungan suara",
                            "ru": "—Ä–µ–π—Ç–∏–Ω–≥ –æ–¥–æ–±—Ä–µ–Ω–∏—è; —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏",
                            "fr": "cote de popularit√©",
                            "es": "porcentaje de apoyo, √≠ndice de apoyo"
                        }
                    },
                    {
                        "id": 13,
                        "dir": "H",
                        "row": 6,
                        "col": 5,
                        "word_enc": "JUVCJUFDJUI0JUVDJTlEJTk4JUVCJUFGJUI4",
                        "hints": {
                            "en": "meaninglessness; insignificance",
                            "ko": "ÏïÑÎ¨¥ ÎúªÏù¥ÎÇò Í∞ÄÏπòÍ∞Ä ÏóÜÏùå.",
                            "cn": "ÊØ´Êó†ÊÑè‰πâÔºåÊ≤°ÊúâÊÑè‰πâ",
                            "jp": "„ÇÄ„ÅÑ„Åø„ÄêÁÑ°ÊÑèÂë≥„Äë„ÄÇ„ÇÄ„ÅÑ„Åé„ÄêÁÑ°ÊÑèÁæ©„Äë",
                            "vn": "v√¥ nghƒ©a ",
                            "id": "tidak bermakna, tidak berarti, tidak bernilai",
                            "ru": "–±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç—å",
                            "fr": "futilit√©, vanit√©, absurdit√©, insignifiance, absence de signification, non-sens   ",
                            "es": "insignificante"
                        }
                    },
                    {
                        "id": 14,
                        "dir": "V",
                        "row": 0,
                        "col": 2,
                        "word_enc": "JUVDJUJEJTk4JUVCJThGJTg0",
                        "hints": {
                            "en": "membership resort",
                            "ko": "Í∞ùÏã§Ïóê Ï∑®ÏÇ¨ ÎèÑÍµ¨Î•º ÎπÑÎ°ØÌïú Í∏∞Î≥∏Ï†ÅÏù∏ ÏÇ¥Î¶ºÏÇ¥Ïù¥Î•º Í∞ñÏ∂îÍ≥† ÏûàÏúºÎ©∞, Í∞ùÏã§ Îã®ÏúÑÎ°ú Î∂ÑÏñëÌïòÏó¨ Ïö¥ÏòÅÌïòÎäî ÌòïÌÉúÏùò Ìò∏ÌÖî.",
                            "cn": "ÂÖ¨ÂØìÂºèÈÖíÂ∫óÔºåÂÖ¨ÂØìÔºåÈÖíÂ∫óÂºèÂÖ¨ÂØì",
                            "jp": "„Ç≥„É≥„Éâ„Éü„Éã„Ç¢„É†„ÄÇ„Å∂„Çì„Åò„Çá„ÅÜ„Éû„É≥„Ç∑„Éß„É≥„ÄêÂàÜË≠≤„Éû„É≥„Ç∑„Éß„É≥„Äë„ÄÇ„É™„Çæ„Éº„Éà„Éû„É≥„Ç∑„Éß„É≥",
                            "vn": "(condo) kh√°ch s·∫°n d·∫°ng cƒÉn h·ªô",
                            "id": "kondominium",
                            "ru": "–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞ –∫–≤–∞—Ä—Ç–∏—Ä–Ω–æ–≥–æ —Ç–∏–ø–∞",
                            "fr": "copropri√©t√©, immeuble en copropri√©t√©",
                            "es": "condominio"
                        }
                    }
                ]
            }
        ];

        const UI_TEXT = {
            en: {
                title: "Daily Chosung Quiz",
                key_on: "‚å®Ô∏è Keyboard On",
                key_off: "‚å®Ô∏è Keyboard Off",
                btn_reveal: "üí° Reveal Answer",
                btn_hide: "üôà Hide Answer",
                confirm_reveal: "Are you sure you want to reveal the answers?",
                header_h: "Horizontal",
                header_v: "Vertical",
                modal_title: "Success!",
                modal_desc: "You completed the puzzle!",
                modal_result: "Time: {m}m {s}s",
                modal_close: "Close",
                status_load: "Loading puzzle...",
                status_fail: "Failed to load puzzle.",
                status_nodata: "No puzzle data for today."
            },
            ko: {
                title: "Ïò§ÎäòÏùò Ï¥àÏÑ± ÌÄ¥Ï¶à",
                key_on: "‚å®Ô∏è ÏûêÌåê ÏºúÍ∏∞",
                key_off: "‚å®Ô∏è ÏûêÌåê ÎÅÑÍ∏∞",
                btn_reveal: "üí° Ï†ïÎãµ Î≥¥Í∏∞",
                btn_hide: "üôà Ï†ïÎãµ Í∞ÄÎ¶¨Í∏∞",
                confirm_reveal: "Ï†ïÎßê Ï†ïÎãµÏùÑ ÌôïÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?",
                header_h: "Í∞ÄÎ°ú",
                header_v: "ÏÑ∏Î°ú",
                modal_title: "ÏÑ±Í≥µ!",
                modal_desc: "Ïò§ÎäòÏùò ÌçºÏ¶êÏùÑ ÏôÑÏÑ±ÌñàÏäµÎãàÎã§!",
                modal_result: "Í±∏Î¶∞ ÏãúÍ∞Ñ: {m}Î∂Ñ {s}Ï¥à",
                modal_close: "Îã´Í∏∞",
                status_load: "ÌçºÏ¶êÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...",
                status_fail: "ÌçºÏ¶êÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.",
                status_nodata: "Ïò§ÎäòÏùò ÌçºÏ¶ê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§."
            },
            cn: {
                title: "‰ªäÊó•ÂàùÂ£∞ÊµãÈ™å",
                key_on: "‚å®Ô∏è ÊâìÂºÄÈîÆÁõò",
                key_off: "‚å®Ô∏è ÂÖ≥Èó≠ÈîÆÁõò",
                btn_reveal: "üí° ÊòæÁ§∫Á≠îÊ°à",
                btn_hide: "üôà ÈöêËóèÁ≠îÊ°à",
                confirm_reveal: "ÊÇ®Á°ÆÂÆöË¶ÅÊòæÁ§∫Á≠îÊ°àÂêóÔºü",
                header_h: "Ê∞¥Âπ≥",
                header_v: "ÂûÇÁõ¥",
                modal_title: "ÊàêÂäüÔºÅ",
                modal_desc: "ÊÇ®ÂÆåÊàê‰∫Ü‰ªäÂ§©ÁöÑÊãºÂõæÔºÅ",
                modal_result: "Áî®Êó∂: {m}ÂàÜ {s}Áßí",
                modal_close: "ÂÖ≥Èó≠",
                status_load: "Ê≠£Âú®Âä†ËΩΩÊãºÂõæ...",
                status_fail: "Âä†ËΩΩÊãºÂõæÂ§±Ë¥•„ÄÇ",
                status_nodata: "‰ªäÂ§©Ê≤°ÊúâÊãºÂõæÊï∞ÊçÆ„ÄÇ"
            },
            jp: {
                title: "‰ªäÊó•„ÅÆÂàùÂ£∞„ÇØ„Ç§„Ç∫",
                key_on: "‚å®Ô∏è „Ç≠„Éº„Éú„Éº„ÉâË°®Á§∫",
                key_off: "‚å®Ô∏è „Ç≠„Éº„Éú„Éº„ÉâÈùûË°®Á§∫",
                btn_reveal: "üí° Á≠î„Åà„ÇíË¶ã„Çã",
                btn_hide: "üôà Á≠î„Åà„ÇíÈö†„Åô",
                confirm_reveal: "Êú¨ÂΩì„Å´Á≠î„Åà„ÇíË¶ã„Åæ„Åô„ÅãÔºü",
                header_h: "Ê®™ (Horizontal)",
                header_v: "Á∏¶ (Vertical)",
                modal_title: "ÊàêÂäüÔºÅ",
                modal_desc: "„Éë„Ç∫„É´„ÇíÂÆåÊàê„Åï„Åõ„Åæ„Åó„ÅüÔºÅ",
                modal_result: "ÊâÄË¶ÅÊôÇÈñì: {m}ÂàÜ {s}Áßí",
                modal_close: "Èñâ„Åò„Çã",
                status_load: "„Éë„Ç∫„É´„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...",
                status_fail: "„Éë„Ç∫„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ",
                status_nodata: "‰ªäÊó•„ÅÆ„Éë„Ç∫„É´„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ"
            },
            vn: {
                title: "C√¢u ƒë·ªë Chosung h√†ng ng√†y",
                key_on: "‚å®Ô∏è B·∫≠t b√†n ph√≠m",
                key_off: "‚å®Ô∏è T·∫Øt b√†n ph√≠m",
                btn_reveal: "üí° Xem ƒë√°p √°n",
                btn_hide: "üôà ·∫®n ƒë√°p √°n",
                confirm_reveal: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xem ƒë√°p √°n kh√¥ng?",
                header_h: "Ngang",
                header_v: "D·ªçc",
                modal_title: "Th√†nh c√¥ng!",
                modal_desc: "B·∫°n ƒë√£ ho√†n th√†nh c√¢u ƒë·ªë!",
                modal_result: "Th·ªùi gian: {m} ph√∫t {s} gi√¢y",
                modal_close: "ƒê√≥ng",
                status_load: "ƒêang t·∫£i c√¢u ƒë·ªë...",
                status_fail: "Kh√¥ng t·∫£i ƒë∆∞·ª£c c√¢u ƒë·ªë.",
                status_nodata: "Kh√¥ng c√≥ d·ªØ li·ªáu c√¢u ƒë·ªë cho h√¥m nay."
            },
            id: {
                title: "Kuis Chosung Harian",
                key_on: "‚å®Ô∏è Buka Keyboard",
                key_off: "‚å®Ô∏è Tutup Keyboard",
                btn_reveal: "üí° Lihat Jawaban",
                btn_hide: "üôà Sembunyikan Jawaban",
                confirm_reveal: "Apakah Anda yakin ingin melihat jawabannya?",
                header_h: "Mendatar",
                header_v: "Menurun",
                modal_title: "Berhasil!",
                modal_desc: "Anda menyelesaikan teka-teki!",
                modal_result: "Waktu: {m}m {s}d",
                modal_close: "Tutup",
                status_load: "Memuat teka-teki...",
                status_fail: "Gagal memuat teka-teki.",
                status_nodata: "Tidak ada data teka-teki hari ini."
            },
            ru: {
                title: "–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞",
                key_on: "‚å®Ô∏è –í–∫–ª. –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É",
                key_off: "‚å®Ô∏è –í—ã–∫–ª. –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É",
                btn_reveal: "üí° –û—Ç–≤–µ—Ç",
                btn_hide: "üôà –°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç",
                confirm_reveal: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–≤–∏–¥–µ—Ç—å –æ—Ç–≤–µ—Ç?",
                header_h: "–ü–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏",
                header_v: "–ü–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏",
                modal_title: "–£—Å–ø–µ—Ö!",
                modal_desc: "–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫—É!",
                modal_result: "–í—Ä–µ–º—è: {m}–º {s}—Å",
                modal_close: "–ó–∞–∫—Ä—ã—Ç—å",
                status_load: "–ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏...",
                status_fail: "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ–ª–æ–≤–æ–ª–æ–º–∫—É.",
                status_nodata: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏."
            },
            fr: {
                title: "Quiz Chosung Quotidien",
                key_on: "‚å®Ô∏è Activer Clavier",
                key_off: "‚å®Ô∏è D√©sactiver Clavier",
                btn_reveal: "üí° Solution",
                btn_hide: "üôà Masquer",
                confirm_reveal: "√ätes-vous s√ªr de vouloir voir la r√©ponse ?",
                header_h: "Horizontal",
                header_v: "Vertical",
                modal_title: "Succ√®s!",
                modal_desc: "Vous avez termin√© le puzzle !",
                modal_result: "Temps: {m}m {s}s",
                modal_close: "Fermer",
                status_load: "Chargement du puzzle...",
                status_fail: "√âchec du chargement.",
                status_nodata: "Pas de puzzle pour aujourd'hui."
            },
            es: {
                title: "Prueba Diaria Chosung",
                key_on: "‚å®Ô∏è Teclado On",
                key_off: "‚å®Ô∏è Teclado Off",
                btn_reveal: "üí° Soluci√≥n",
                btn_hide: "üôà Ocultar",
                confirm_reveal: "¬øEst√°s seguro de que quieres ver la respuesta?",
                header_h: "Horizontal",
                header_v: "Vertical",
                modal_title: "¬°√âxito!",
                modal_desc: "¬°Completaste el rompecabezas!",
                modal_result: "Tiempo: {m}m {s}s",
                modal_close: "Cerrar",
                status_load: "Cargando rompecabezas...",
                status_fail: "Error al cargar.",
                status_nodata: "No hay datos para hoy."
            }
        };

        document.addEventListener('DOMContentLoaded', async () => {
            const dateEl = document.getElementById('date-display');
            const statusEl = document.getElementById('status-msg');
            const gameContainer = document.getElementById('game-board');
            const controls = document.getElementById('game-controls');

            currentLanguage = document.getElementById('language-select').value;
            updateUIText();

            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const todayStr = `${year}-${month}-${day}`;
            
            dateEl.textContent = todayStr;

            let allPuzzles = [];

            try {
                const response = await fetch('puzzles.json');
                if (!response.ok) throw new Error("Îç∞Ïù¥ÌÑ∞ ÌååÏùº Î°úÎìú Ïã§Ìå®");
                allPuzzles = await response.json();
            } catch (error) {
                console.warn("Fetch failed, using debug data:", error);
                allPuzzles = DEBUG_PUZZLE_DATA;
                // ÎîîÎ≤ÑÍπÖÏùÑ ÏúÑÌï¥ Ï≤´ Î≤àÏß∏ ÌçºÏ¶êÏùò ÎÇ†ÏßúÎ•º Ïò§ÎäòÎ°ú Í∞ïÏ†ú ÏÑ§Ï†ï
                if (allPuzzles.length > 0) allPuzzles[0].date = todayStr;
            }

            const todayPuzzle = allPuzzles.find(p => p.date === todayStr);

            if (todayPuzzle) {
                statusEl.style.display = 'none';
                gameContainer.style.display = 'flex';
                controls.style.display = 'flex';
                
                gridSize = todayPuzzle.gridSize || 8;
                initGame(todayPuzzle.puzzleData);
            } else {
                statusEl.textContent = UI_TEXT[currentLanguage].status_nodata;
                statusEl.style.color = "red";
            }
        });

        function startTimer() {
            stopTimer();
            timerSeconds = 0;
            isGameRunning = true;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
            }, 1000);
        }

        function resumeTimer() {
            if (isGameRunning) return;
            isGameRunning = true;
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
            }, 1000);
        }

        function stopTimer() {
            isGameRunning = false;
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimerDisplay() {
            const m = Math.floor(timerSeconds / 60).toString().padStart(2, '0');
            const s = (timerSeconds % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').textContent = `${m}:${s}`;
        }

        function getChosung(char) {
            const code = char.charCodeAt(0) - 44032;
            if (code > -1 && code < 11172) {
                return CHOSUNG_LIST[Math.floor(code / 588)];
            }
            return char;
        }

        function decodeData(data) {
            return data.map(item => {
                try {
                    const decodedWord = decodeURIComponent(atob(item.word_enc));
                    const chosungs = decodedWord.split('').map(getChosung).join('');
                    const hints = item.hints || { "en": item.hint || "No Hint" };
                    return { ...item, word: decodedWord, chosungs: chosungs, hints: hints };
                } catch (e) {
                    return { ...item, word: "ERROR", chosungs: "??", hints: {"en":"Error"} };
                }
            });
        }

        function changeLanguage() {
            const select = document.getElementById('language-select');
            currentLanguage = select.value;
            updateUIText();
            if (globalPuzzleData.length > 0) {
                renderHints(globalPuzzleData);
            }
        }

        function updateUIText() {
            const texts = UI_TEXT[currentLanguage] || UI_TEXT['en'];
            document.getElementById('ui-title').textContent = texts.title;
            document.getElementById('ui-header-h').textContent = texts.header_h;
            document.getElementById('ui-header-v').textContent = texts.header_v;
            document.getElementById('ui-modal-title').textContent = texts.modal_title;
            document.getElementById('ui-modal-desc').textContent = texts.modal_desc;
            document.getElementById('ui-modal-close').textContent = texts.modal_close;
            updateKeyboardButtonText();
            document.getElementById('reveal-btn').textContent = isRevealed ? texts.btn_hide : texts.btn_reveal;
        }

        function updateKeyboardButtonText() {
            const kb = document.getElementById('virtual-keyboard');
            const btn = document.getElementById('toggle-keyboard-btn');
            const texts = UI_TEXT[currentLanguage] || UI_TEXT['en'];

            if (kb.classList.contains('visible')) {
                btn.textContent = texts.key_off;
            } else {
                btn.textContent = texts.key_on;
            }
        }

        function initGame(rawData) {
            globalPuzzleData = decodeData(rawData);
            
            globalGridMap = Array.from({ length: gridSize }, () => Array.from({ length: gridSize }, () => ({
                active: false,
                answerChosung: null, 
                fullSyllables: new Set(),
                clueNum: null,
                inputElement: null
            })));

            let startPositions = Array.from({ length: gridSize }, () => Array(gridSize).fill(false));

            globalPuzzleData.forEach((item) => {
                startPositions[item.row][item.col] = true;
                let r = item.row;
                let c = item.col;
                for (let i = 0; i < item.word.length; i++) {
                    if (r < gridSize && c < gridSize) {
                        globalGridMap[r][c].active = true;
                        globalGridMap[r][c].answerChosung = item.chosungs[i];
                        globalGridMap[r][c].fullSyllables.add(item.word[i]);
                    }
                    if (item.dir === 'H') c++; else r++;
                }
            });

            let currentClueNum = 1;
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    if (startPositions[r][c]) {
                        globalGridMap[r][c].clueNum = currentClueNum;
                        globalPuzzleData.forEach(item => {
                            if (item.row === r && item.col === c) {
                                item.assignedNum = currentClueNum;
                            }
                        });
                        currentClueNum++;
                    }
                }
            }

            const gridEl = document.getElementById('grid');
            gridEl.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            gridEl.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
            gridEl.innerHTML = ''; 

            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const cellData = globalGridMap[r][c];
                    const cellEl = document.createElement('div');
                    cellEl.className = 'cell';

                    if (!cellData.active) {
                        cellEl.classList.add('blocked');
                        cellEl.textContent = '.';
                    } else {
                        if (cellData.clueNum !== null) {
                            const numSpan = document.createElement('span');
                            numSpan.className = 'clue-number';
                            numSpan.textContent = cellData.clueNum;
                            cellEl.appendChild(numSpan);
                        }

                        const input = document.createElement('input');
                        input.type = 'text';
                        
                        // [ÏàòÏ†ïÎê®] Ï¥àÍ∏∞ ÏÉÅÌÉúÏóêÏÑúÎäî Í∞ÄÏÉÅ ÌÇ§Î≥¥ÎìúÍ∞Ä Í∫ºÏ†∏ ÏûàÏúºÎØÄÎ°ú ÏãúÏä§ÌÖú ÌÇ§Î≥¥Îìú ÌôúÏÑ±Ìôî (inputmode="none" Ï†úÍ±∞)
                        // input.setAttribute("inputmode", "none"); 
                        
                        input.dataset.ans = cellData.answerChosung;
                        input.setAttribute("autocomplete", "off");
                        
                        input.addEventListener('focus', (e) => {
                            lastFocusedInput = e.target;
                            e.target.select();
                        });
                        input.addEventListener('click', function() { this.select(); });

                        input.addEventListener('input', (e) => {
                            const val = e.target.value;
                            const consonants = val.match(/[„Ñ±-„Öé]/g);
                            if (consonants && consonants.length > 0) {
                                e.target.value = consonants[consonants.length - 1];
                            } else {
                                e.target.value = '';
                            }
                            checkCell(e.target);
                            checkWinCondition();
                        });

                        input.addEventListener('keydown', (e) => handleNavigation(e, r, c));

                        cellEl.appendChild(input);
                        cellData.inputElement = input;
                    }
                    gridEl.appendChild(cellEl);
                }
            }

            renderHints(globalPuzzleData);
            createVirtualKeyboard();
            startTimer();
        }

        function renderHints(puzzleData) {
            const hintsH = document.getElementById('hints-horizontal');
            const hintsV = document.getElementById('hints-vertical');
            hintsH.innerHTML = '';
            hintsV.innerHTML = '';

            const horizItems = puzzleData.filter(i => i.dir === 'H').sort((a, b) => a.assignedNum - b.assignedNum);
            const vertItems = puzzleData.filter(i => i.dir === 'V').sort((a, b) => a.assignedNum - b.assignedNum);

            function getHintText(item) {
                if (item.hints[currentLanguage]) return item.hints[currentLanguage];
                if (item.hints['en']) return item.hints['en'];
                return Object.values(item.hints)[0] || "No Hint";
            }

            horizItems.forEach(item => {
                hintsH.innerHTML += `<div class="clue-item"><strong>${item.assignedNum}.</strong> ${getHintText(item)}</div>`;
            });

            vertItems.forEach(item => {
                hintsV.innerHTML += `<div class="clue-item"><strong>${item.assignedNum}.</strong> ${getHintText(item)}</div>`;
            });
        }

        function createVirtualKeyboard() {
            const keyboardContainer = document.getElementById('virtual-keyboard');
            keyboardContainer.innerHTML = ''; 

            CHOSUNG_LIST.forEach(char => {
                const btn = document.createElement('button');
                btn.className = 'key-btn';
                btn.textContent = char;
                btn.addEventListener('mousedown', (e) => {
                    e.preventDefault(); 
                    if (lastFocusedInput) {
                        lastFocusedInput.value = char;
                        lastFocusedInput.dispatchEvent(new Event('input'));
                    }
                });
                keyboardContainer.appendChild(btn);
            });
        }

        // [ÏàòÏ†ïÎê®] ÌÜ†Í∏Ä Ïãú Î™®Îì† inputÏùò inputmode ÏÜçÏÑ± Ï†úÏñ¥
        function toggleKeyboard() {
            const kb = document.getElementById('virtual-keyboard');
            const btn = document.getElementById('toggle-keyboard-btn');
            kb.classList.toggle('visible');
            btn.classList.toggle('active');
            updateKeyboardButtonText();

            // Í∞ÄÏÉÅ ÌÇ§Î≥¥Îìú ÏÉÅÌÉúÏóê Îî∞Îùº ÏãúÏä§ÌÖú ÌÇ§Î≥¥Îìú Ï†úÏñ¥
            const inputs = document.querySelectorAll('.cell input');
            const isVisible = kb.classList.contains('visible');

            inputs.forEach(input => {
                if (isVisible) {
                    // Í∞ÄÏÉÅ ÌÇ§Î≥¥Îìú ÏºúÏßê -> ÏãúÏä§ÌÖú ÌÇ§Î≥¥Îìú ÎÅÑÍ∏∞
                    input.setAttribute('inputmode', 'none');
                } else {
                    // Í∞ÄÏÉÅ ÌÇ§Î≥¥Îìú Í∫ºÏßê -> ÏãúÏä§ÌÖú ÌÇ§Î≥¥Îìú ÏºúÍ∏∞ (ÏÜçÏÑ± Ï†úÍ±∞)
                    input.removeAttribute('inputmode');
                }
            });
        }

        function revealAllAnswers() {
            const texts = UI_TEXT[currentLanguage] || UI_TEXT['en'];
            const btn = document.getElementById('reveal-btn');
            const inputs = document.querySelectorAll('.cell input');

            if (!isRevealed) {
                if (!confirm(texts.confirm_reveal)) return;

                wasTimerRunning = isGameRunning;
                stopTimer();
                
                savedUserInputs = [];
                inputs.forEach(input => {
                    savedUserInputs.push(input.value);
                    input.value = input.dataset.ans;
                    input.readOnly = true;
                    checkCell(input);
                });
                
                isRevealed = true;
                btn.textContent = texts.btn_hide;
            } else {
                inputs.forEach((input, index) => {
                    input.value = savedUserInputs[index];
                    input.readOnly = false;
                    checkCell(input);
                });

                if (wasTimerRunning) resumeTimer();
                isRevealed = false;
                btn.textContent = texts.btn_reveal;
            }
        }

        function checkCell(input) {
            const val = input.value.trim();
            const parent = input.parentElement;
            parent.classList.remove('correct', 'wrong');
            if (val === '') return;
            
            if (val === input.dataset.ans) {
                parent.classList.add('correct');
            } else {
                parent.classList.add('wrong');
            }
        }

        function checkWinCondition() {
            let inputs = document.querySelectorAll('.cell input');
            if (inputs.length === 0) return;
            let allCorrect = true;
            for (let input of inputs) {
                if (input.value !== input.dataset.ans) {
                    allCorrect = false;
                    break;
                }
            }
            if (allCorrect) {
                stopTimer();
                document.activeElement.blur();
                setTimeout(revealAnswers, 100);
            }
        }

        function revealAnswers() {
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const cellData = globalGridMap[r][c];
                    if (cellData.active && cellData.inputElement) {
                        const input = cellData.inputElement;
                        const parent = input.parentElement;
                        const finalText = Array.from(cellData.fullSyllables).join('/');
                        input.remove();
                        const textDiv = document.createElement('div');
                        textDiv.className = 'revealed-text';
                        textDiv.textContent = finalText;
                        parent.appendChild(textDiv);
                    }
                }
            }
            
            const texts = UI_TEXT[currentLanguage] || UI_TEXT['en'];
            const m = Math.floor(timerSeconds / 60);
            const s = timerSeconds % 60;
            const resultMsg = texts.modal_result.replace('{m}', m).replace('{s}', s);
            document.getElementById('ui-modal-time').textContent = resultMsg;

            document.getElementById('congrats-modal').style.display = 'flex';
        }

        function handleNavigation(e, r, c) {
            let nextR = r, nextC = c;
            if (e.key === 'ArrowUp') nextR--;
            else if (e.key === 'ArrowDown') nextR++;
            else if (e.key === 'ArrowLeft') nextC--;
            else if (e.key === 'ArrowRight') nextC++;
            else return;

            if (nextR >= 0 && nextR < gridSize && nextC >= 0 && nextC < gridSize) {
                const nextCell = globalGridMap[nextR][nextC];
                if (nextCell.active && nextCell.inputElement) {
                    e.preventDefault();
                    nextCell.inputElement.focus();
                }
            }
        }
    </script>
</body>
</html>